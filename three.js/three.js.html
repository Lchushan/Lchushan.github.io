<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>three.js | Liang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.64852305.css" as="style"><link rel="preload" href="/assets/js/app.8914b41c.js" as="script"><link rel="preload" href="/assets/js/3.7f8ab6bd.js" as="script"><link rel="preload" href="/assets/js/14.ccd1b44f.js" as="script"><link rel="prefetch" href="/assets/js/10.12b4bf37.js"><link rel="prefetch" href="/assets/js/11.986ec194.js"><link rel="prefetch" href="/assets/js/12.127689ae.js"><link rel="prefetch" href="/assets/js/13.528417d2.js"><link rel="prefetch" href="/assets/js/15.df2ae387.js"><link rel="prefetch" href="/assets/js/16.7bbe874c.js"><link rel="prefetch" href="/assets/js/17.4b65eca3.js"><link rel="prefetch" href="/assets/js/18.b4f5604c.js"><link rel="prefetch" href="/assets/js/19.ada119ee.js"><link rel="prefetch" href="/assets/js/2.f7dde802.js"><link rel="prefetch" href="/assets/js/20.d063279a.js"><link rel="prefetch" href="/assets/js/21.d15b3ac7.js"><link rel="prefetch" href="/assets/js/22.5185a1a5.js"><link rel="prefetch" href="/assets/js/23.91b5f7c4.js"><link rel="prefetch" href="/assets/js/24.545bc1fb.js"><link rel="prefetch" href="/assets/js/25.ce0688e9.js"><link rel="prefetch" href="/assets/js/26.14f7ddb2.js"><link rel="prefetch" href="/assets/js/27.1d380883.js"><link rel="prefetch" href="/assets/js/28.84fd7342.js"><link rel="prefetch" href="/assets/js/29.977a10c6.js"><link rel="prefetch" href="/assets/js/30.e27d5c6c.js"><link rel="prefetch" href="/assets/js/31.fef44b40.js"><link rel="prefetch" href="/assets/js/32.3cde5ab7.js"><link rel="prefetch" href="/assets/js/33.2fd0f2f0.js"><link rel="prefetch" href="/assets/js/34.6174b407.js"><link rel="prefetch" href="/assets/js/35.3457d0d3.js"><link rel="prefetch" href="/assets/js/36.c672256a.js"><link rel="prefetch" href="/assets/js/37.c5336199.js"><link rel="prefetch" href="/assets/js/38.f878aa15.js"><link rel="prefetch" href="/assets/js/39.7272608e.js"><link rel="prefetch" href="/assets/js/4.591798d0.js"><link rel="prefetch" href="/assets/js/40.1f5087ab.js"><link rel="prefetch" href="/assets/js/41.d8defd1f.js"><link rel="prefetch" href="/assets/js/42.4decf61e.js"><link rel="prefetch" href="/assets/js/43.1f54a9fb.js"><link rel="prefetch" href="/assets/js/44.05628c46.js"><link rel="prefetch" href="/assets/js/45.b64569a4.js"><link rel="prefetch" href="/assets/js/46.3e758616.js"><link rel="prefetch" href="/assets/js/47.754e4534.js"><link rel="prefetch" href="/assets/js/48.d7707287.js"><link rel="prefetch" href="/assets/js/49.c62b8419.js"><link rel="prefetch" href="/assets/js/5.ae5a8b30.js"><link rel="prefetch" href="/assets/js/50.60fbaa68.js"><link rel="prefetch" href="/assets/js/51.812c8fc9.js"><link rel="prefetch" href="/assets/js/52.bae4e31b.js"><link rel="prefetch" href="/assets/js/53.bdcc492b.js"><link rel="prefetch" href="/assets/js/54.c9eece36.js"><link rel="prefetch" href="/assets/js/55.bec15e04.js"><link rel="prefetch" href="/assets/js/56.3e4a4b07.js"><link rel="prefetch" href="/assets/js/57.300f3929.js"><link rel="prefetch" href="/assets/js/58.9b3bc2f8.js"><link rel="prefetch" href="/assets/js/59.b4f2f65a.js"><link rel="prefetch" href="/assets/js/6.c6d5d1da.js"><link rel="prefetch" href="/assets/js/60.6da1c705.js"><link rel="prefetch" href="/assets/js/61.0f431e1e.js"><link rel="prefetch" href="/assets/js/62.ca980bdb.js"><link rel="prefetch" href="/assets/js/63.b1d0e0d0.js"><link rel="prefetch" href="/assets/js/64.a5dc88b1.js"><link rel="prefetch" href="/assets/js/65.2134e59f.js"><link rel="prefetch" href="/assets/js/66.2ce26325.js"><link rel="prefetch" href="/assets/js/67.be6c5ba6.js"><link rel="prefetch" href="/assets/js/68.5ee46489.js"><link rel="prefetch" href="/assets/js/69.817ef5b5.js"><link rel="prefetch" href="/assets/js/7.39a2feef.js"><link rel="prefetch" href="/assets/js/70.bd026d5e.js"><link rel="prefetch" href="/assets/js/71.94cd51c9.js"><link rel="prefetch" href="/assets/js/72.2852256c.js"><link rel="prefetch" href="/assets/js/73.ff13867e.js"><link rel="prefetch" href="/assets/js/74.d43a4484.js"><link rel="prefetch" href="/assets/js/75.8a138783.js"><link rel="prefetch" href="/assets/js/76.75869419.js"><link rel="prefetch" href="/assets/js/77.85ccf9b3.js"><link rel="prefetch" href="/assets/js/78.d1f93c97.js"><link rel="prefetch" href="/assets/js/79.476c7345.js"><link rel="prefetch" href="/assets/js/8.6aa44381.js"><link rel="prefetch" href="/assets/js/80.75df788e.js"><link rel="prefetch" href="/assets/js/81.8dabfdfb.js"><link rel="prefetch" href="/assets/js/82.b373d124.js"><link rel="prefetch" href="/assets/js/83.543e5130.js"><link rel="prefetch" href="/assets/js/84.551d04d7.js"><link rel="prefetch" href="/assets/js/85.21a99aad.js"><link rel="prefetch" href="/assets/js/9.ab9a5c08.js">
    <link rel="stylesheet" href="/assets/css/0.styles.64852305.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Liang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  vuepress
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/插件小技巧/" class="nav-link">
  插件小技巧
</a></li><li class="dropdown-item"><!----> <a href="/前端问题/" class="nav-link">
  前端问题
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue问题
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react问题
</a></li><li class="dropdown-item"><!----> <a href="/优化问题/" class="nav-link">
  优化问题
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/regular&amp;git/regular/" class="nav-link">
  正则&amp;git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="画图小软件" class="dropdown-title"><span class="title">画图小软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="画图小软件" class="mobile-dropdown-title"><span class="title">画图小软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/three.js/" class="nav-link router-link-active">
  three.js
</a></li><li class="dropdown-item"><!----> <a href="/eChart/" class="nav-link">
  eChart
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微前端" class="dropdown-title"><span class="title">微前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微前端" class="mobile-dropdown-title"><span class="title">微前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qiankun/" class="nav-link">
  qiankun
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/progress/" class="nav-link">
  记录问题
</a></li><li class="dropdown-item"><!----> <a href="/小案例/" class="nav-link">
  小案例
</a></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/Lchu3/lchushan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  vuepress
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/插件小技巧/" class="nav-link">
  插件小技巧
</a></li><li class="dropdown-item"><!----> <a href="/前端问题/" class="nav-link">
  前端问题
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue问题
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react问题
</a></li><li class="dropdown-item"><!----> <a href="/优化问题/" class="nav-link">
  优化问题
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/regular&amp;git/regular/" class="nav-link">
  正则&amp;git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="画图小软件" class="dropdown-title"><span class="title">画图小软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="画图小软件" class="mobile-dropdown-title"><span class="title">画图小软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/three.js/" class="nav-link router-link-active">
  three.js
</a></li><li class="dropdown-item"><!----> <a href="/eChart/" class="nav-link">
  eChart
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微前端" class="dropdown-title"><span class="title">微前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微前端" class="mobile-dropdown-title"><span class="title">微前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qiankun/" class="nav-link">
  qiankun
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/progress/" class="nav-link">
  记录问题
</a></li><li class="dropdown-item"><!----> <a href="/小案例/" class="nav-link">
  小案例
</a></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/Lchu3/lchushan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>three.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/three.js/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/three.js/SimpleModel.html" class="sidebar-link">简单模型</a></li><li><a href="/three.js/SimpleDynamicEffect.html" class="sidebar-link">简单动效</a></li><li><a href="/three.js/SimpleInteraction.html" class="sidebar-link">简单互动</a></li><li><a href="/three.js/SimpleFont.html" class="sidebar-link">简单字体</a></li><li><a href="/three.js/SpaceModel.html" class="sidebar-link">空间模型</a></li><li><a href="/three.js/SpecialEffects.html" class="sidebar-link">特效效果</a></li><li><a href="/three.js/three.js.html" aria-current="page" class="active sidebar-link">three.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/three.js/three.js.html#three-js文档结构" class="sidebar-link">three.js文档结构</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#three-js控制物体显示与隐藏的方法" class="sidebar-link">Three.js控制物体显示与隐藏的方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/three.js/three.js.html#visible属性" class="sidebar-link">visible属性</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#layers属性" class="sidebar-link">layers属性</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#clock" class="sidebar-link">Clock</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/three.js/three.js.html#getdelta-方法" class="sidebar-link">.getDelta ()方法</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#两帧渲染时间间隔" class="sidebar-link">两帧渲染时间间隔</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#属性-autostart-boolean" class="sidebar-link">属性.autoStart: Boolean</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#属性-starttime-float" class="sidebar-link">属性.startTime : Float</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#属性-starttime-float-2" class="sidebar-link">属性.startTime : Float</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#属性-elapsedtime-float" class="sidebar-link">属性.elapsedTime : Float</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#属性-running-boolean" class="sidebar-link">属性.running : Boolean</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#方法-start" class="sidebar-link">方法.start ()</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#方法-stop" class="sidebar-link">方法.stop ()</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#方法-getelapsedtime" class="sidebar-link">方法.getElapsedTime ()</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#方法-getdelta" class="sidebar-link">方法.getDelta ()</a></li></ul></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#案例" class="sidebar-link">案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/three.js/three.js.html#地球绕太阳自转公转" class="sidebar-link">地球绕太阳自转公转</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#球体按轨迹运动-webgl三维场景" class="sidebar-link">球体按轨迹运动_WebGL三维场景</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#three-js三维地图可视化" class="sidebar-link">Three.js三维地图可视化</a></li><li class="sidebar-sub-header"><a href="/three.js/three.js.html#可视化地图-three-js实现" class="sidebar-link">可视化地图——three.js实现</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="three-js"><a href="#three-js" class="header-anchor">#</a> three.js</h1> <p><a href="http://www.webgl3d.cn/" target="_blank" rel="noopener noreferrer">Three.js中文网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="three-js文档结构"><a href="#three-js文档结构" class="header-anchor">#</a> three.js文档结构</h2> <p>通过下面的树状图简单展示了从three.js官网下载的文件three.js-master包含的子文件，有些内容已经在线部署，可以通过树状图上的超链接直接访问。</p> <p><img src="/assets/img/three-01.2cc1d8fc.png" alt="截屏2023-07-21 14.55.11"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--引入three.js三维引擎--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.yanhuangxueyuan.com/3D/example/three.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">/**
        * 创建场景对象
       */</span>
      <span class="token keyword">var</span> scene<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * 创建网格模型
       */</span>
      <span class="token keyword">var</span> box<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个立方体几何对象</span>
      <span class="token keyword">var</span> material<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span><span class="token number">0x0000ff</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//材质对象</span>
      <span class="token keyword">var</span> mesh<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>box<span class="token punctuation">,</span>material<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型对象</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//网格模型添加到场景中</span>


      <span class="token comment">/**
        * 创建渲染器对象
        */</span>
      <span class="token keyword">var</span> renderer<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
      renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token number">0xb9d3ff</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置背景颜色</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//body元素中插入canvas对象</span>
      <span class="token comment">//执行渲染操作</span>
      renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//声明一个空几何体对象</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点1坐标</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点2坐标</span>
<span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点3坐标</span>
geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//顶点坐标添加到geometry对象</span>
<span class="token keyword">var</span> face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Face3</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建三角面</span>
<span class="token comment">/**顶点颜色**/</span>
<span class="token keyword">var</span> color1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0xFF0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//顶点1颜色——红色</span>
<span class="token keyword">var</span> color2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x00FF00</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//顶点2颜色——绿色</span>
<span class="token keyword">var</span> color3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x0000FF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//顶点3颜色——蓝色</span>
<span class="token keyword">var</span> normal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//三角面法向量</span>
face<span class="token punctuation">.</span>vertexColors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>color1<span class="token punctuation">,</span> color2<span class="token punctuation">,</span>color3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义三角面三个顶点的颜色</span>
geometry<span class="token punctuation">.</span>faces<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> face <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//三角面添加到几何体</span>
</code></pre></div><h2 id="three-js控制物体显示与隐藏的方法"><a href="#three-js控制物体显示与隐藏的方法" class="header-anchor">#</a> Three.js控制物体显示与隐藏的方法</h2> <p>主要包括以下几种方式：</p> <ol><li>visible属性；</li> <li>layers属性。</li></ol> <h3 id="visible属性"><a href="#visible属性" class="header-anchor">#</a> visible属性</h3> <p><code>visible</code> 是<a href="https://link.segmentfault.com/?enc=yY9hL6Z%2BqaX9EiTJFtmcIA%3D%3D.PWmdTT3b41ytgFzKLLAitZ1UXcLlFjr1J%2BbIdVE9QyGJIKi4QMmVEV8lFAE5U2gKbWRtIW0taT%2FgIJVgYE4bM0%2FrGjbGIn89e4fp6UtLczY%3D" target="_blank" rel="noopener noreferrer">Object3D的属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。只有当 <code>visible</code> 是 <code>true</code> 的时候，该物体才会被渲染。任何继承 <code>Object3D</code> 的对象都可以通过该属性去控制它的显示与否，比如：<code>Mesh</code>，<code>Group</code>，<code>Sprite</code>，<code>Light</code>等。</p> <p>举个简单的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 控制单个物体的显示和隐藏</span>

<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1*1的一个平面</span>

<span class="token keyword">const</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 红色平面</span>

<span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span>

plane<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 不显示单个物体</span>

scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plane<span class="token punctuation">)</span>
<span class="token comment">// 控制一组物体的显示和隐藏</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span>
<span class="token keyword">const</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plane<span class="token punctuation">)</span>
group<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 不显示一组物体</span>

scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
</code></pre></div><p>通过后面的例子可以看出，当我们想要控制一组物体的显示与隐藏，可以把这些物体放入一个 <code>Group</code> 中，只通过控制 <code>Group</code> 的显示与隐藏即可。</p> <p>这块的代码逻辑是在<a href="https://link.segmentfault.com/?enc=vtPiwcEGd8DMDLH2BqYrdA%3D%3D.F0iAlm6ua1BlDgJJxpmDnnCZe6d2P4iQ27OWvKCkR2%2FWZecoBFqTktPg1jiuayx%2Fy7Rsh9KWvU2UNRC5O1j1d0nS4HLecvdHYbruoP2YN1E%3D" target="_blank" rel="noopener noreferrer">WebGLRenderer.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的 <code>projectObject</code> 方法中实现的。</p> <p>首先，在 <code>render</code> 方法中调用了 <code>projectObject</code> 方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">scene<span class="token punctuation">,</span> camera</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token function">projectObject</span><span class="token punctuation">(</span> scene<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _this<span class="token punctuation">.</span>sortObjects <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>projectObject</code> 方法的定义如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">projectObject</span><span class="token punctuation">(</span> <span class="token parameter">object<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> groupOrder<span class="token punctuation">,</span> sortObjects</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> object<span class="token punctuation">.</span>visible <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 注释1：visible属性是false直接返回</span>
  <span class="token comment">// ...</span>

  <span class="token keyword">var</span> children <span class="token operator">=</span> object<span class="token punctuation">.</span>children<span class="token punctuation">;</span> <span class="token comment">// 注释2：递归应用在children上</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token function">projectObject</span><span class="token punctuation">(</span> children<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">,</span> camera<span class="token punctuation">,</span> groupOrder<span class="token punctuation">,</span> sortObjects <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注释2：递归应用在children上</span>


  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>从注释1可以看出，如果 <code>Group</code> 的 <code>visible</code> 是 <code>false</code>，那么就不会在 <code>children</code> 上递归调用，所以就能达到通过 <code>Group</code> 控制一组对象的显示与隐藏的效果。</p> <p>当 <code>visible</code> 是 <code>false</code> 的时候，<code>Raycaster</code> 的 <code>intersectObject</code> 或者 <code>intersectObjects</code> 也不会把该物体考虑在内。这块的代码逻辑是在 <a href="https://link.segmentfault.com/?enc=nBg0hxaShwpKWTznySqeMQ%3D%3D.zh8%2BGbhwl3TaEUwcw0IjSJYarAMqZBJO8SRupl5cZgqz30E8qdCkBAl4pnMc5mr4PB%2FJyQ9o3ukVYzhag6sIX5Vs%2B9O8MBzAKQyl2GY94b4%3D" target="_blank" rel="noopener noreferrer">Raycaster.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">intersectObject</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">object<span class="token punctuation">,</span> recursive<span class="token punctuation">,</span> optionalTarget</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>

  <span class="token function">intersectObject</span><span class="token punctuation">(</span> object<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> intersects<span class="token punctuation">,</span> recursive <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注释1：调用了公共方法intersectObject</span>
<span class="token comment">// ...</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>


<span class="token function-variable function">intersectObjects</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">objects<span class="token punctuation">,</span> recursive<span class="token punctuation">,</span> optionalTarget</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token function">intersectObject</span><span class="token punctuation">(</span> objects<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> intersects<span class="token punctuation">,</span> recursive <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注释1：循环调用了公共方法intersectObject</span>


  <span class="token punctuation">}</span>
<span class="token comment">// ...</span>

<span class="token punctuation">}</span>

<span class="token comment">// 注释1：公共方法intersectObject</span>
<span class="token keyword">function</span> <span class="token function">intersectObject</span><span class="token punctuation">(</span> <span class="token parameter">object<span class="token punctuation">,</span> raycaster<span class="token punctuation">,</span> intersects<span class="token punctuation">,</span> recursive</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> object<span class="token punctuation">.</span>visible <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 注释1：如果visible是false，直接return</span>

<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>从注释1可以看出，如果 <code>Group</code> 或者单个物体的 <code>visible</code> 是 <code>false</code> ，就不做检测了。</p> <h3 id="layers属性"><a href="#layers属性" class="header-anchor">#</a> layers属性</h3> <p><a href="https://link.segmentfault.com/?enc=dH6eQuBPMC%2Boc%2BTjEs46MA%3D%3D.S9uYV1%2BYV%2FiShu9OzlK9EbXe%2Bc07q31nNKyhw76Q2XaR7a%2FQnNXdozwrSK15mnQEVzoWBc6TP73TtLkXx8vn0w%3D%3D" target="_blank" rel="noopener noreferrer">Object3D的layers属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个 <a href="https://link.segmentfault.com/?enc=8xymlYQlwmaFg7%2BkGq6GYg%3D%3D.YN1HjOqiRHcn9xm0r1pDjZi68S5s%2BmbUejTjR%2FMQiP9Bj5ssNY%2F3iOFYi5f2F7xc%2FvsqASycx8O7hloEG%2Bf5Ow%3D%3D" target="_blank" rel="noopener noreferrer">Layers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象。任何继承 <code>Object3D</code> 的对象都有这个属性，比如 <code>Camera</code> 。<code>Raycaster</code> 虽然不是继承自 <code>Object3D</code> ，但它同样有 <code>layers</code> 属性（r113版本以上）。</p> <p>和上面的 <code>visible</code> 属性一样，<code>layers</code> 属性同样可以控制物体的显示与隐藏、<code>Raycaster</code> 的行为。当物体和相机<strong>至少有一个</strong>同样的层的时候，物体就可见，否则不可见。同样，当物体和 <code>Raycaster</code> <strong>至少有一个</strong>同样的层的时候，才会进行是否相交的测试。这里，强调了是<strong>至少有一个</strong>，是因为 <code>Layers</code> 可以设置多个层。</p> <p><code>Layers</code> 一共可以表示 <code>32</code> 个层，<code>0</code> 到 <code>31</code> 层。内部表示为：</p> <p><img src="/assets/img/three-05.d339722b.png" alt="7296e1646cf7b20af279a4aa7d6498ae.png"></p> <p><code>Layers</code> 可以设置同时拥有多个层：</p> <ol><li>可以通过 <code>Layers</code> 的 <code>enable</code> 和 <code>disable</code> 方法开启和关闭当前层，参数是上面表格中的 <code>0</code> 到 <code>31</code> 。</li> <li>可以通过 <code>Layers</code> 的 <code>set</code> 方法 <strong>只开启</strong> 当前层，参数是上述表格中的 <code>0</code> 到 <code>31</code>。</li> <li>可以通过 <code>Layers</code> 的 <code>test</code> 的方法判断两个 <code>Layers</code> 对象是否存在 <strong>至少一个公共层</strong> 。</li></ol> <p>当开启多个层的时候，其实就是上述表格中的二进制进行 <strong>按位或</strong> 操作。比如 <strong>同时</strong> 开启 <code>0</code>、<code>2</code>、<code>31</code> 层，那么内部存储的值就是 <code>10000000000000000000000000000101</code>。</p> <p><code>layers</code> 属性默认只开启 <code>0</code> 层。</p> <p>还是上面那个例子，我们看下怎么控制物体的显示和隐藏：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 控制单个物体的显示和隐藏</span>

<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span>

plane<span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 设置平面只有第1层，相机默认是在第0层，所以该物体不会显示出来</span>

scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plane<span class="token punctuation">)</span>
<span class="token comment">// 控制一组物体的显示和隐藏</span>
<span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span>
<span class="token keyword">const</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
group<span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 注释1: 设置group只有第一层，相机默认是在第0层，但是此时平面物体还是显示出来了？</span>
group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plane<span class="token punctuation">)</span>

scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
</code></pre></div><p>设置单个物体的 <code>layer</code> 可以看到物体成功的没有显示出来。但是，当我们给 <code>group</code> 设置 <code>layer</code> 之后，发现 <code>group</code> 的 <code>children</code>（平面物体）还是显示了出来。那么，这是什么原因呢？让我们看下源码，同样还是上面的 <code>projectObject</code> 方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">projectObject</span><span class="token punctuation">(</span> <span class="token parameter">object<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> groupOrder<span class="token punctuation">,</span> sortObjects</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> object<span class="token punctuation">.</span>visible <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>


  <span class="token keyword">var</span> visible <span class="token operator">=</span> object<span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span> camera<span class="token punctuation">.</span>layers <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注释1：判断物体和相机是否存在一个公共层</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> visible <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注释1：如果存在，对物体进行下面的处理</span>
<span class="token comment">// ...</span>

  <span class="token punctuation">}</span>


  <span class="token keyword">var</span> children <span class="token operator">=</span> object<span class="token punctuation">.</span>children<span class="token punctuation">;</span> <span class="token comment">// 注释1：不管该物体是否和相机存在一个公共层，都会对children进行递归</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token function">projectObject</span><span class="token punctuation">(</span> children<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">,</span> camera<span class="token punctuation">,</span> groupOrder<span class="token punctuation">,</span> sortObjects <span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>从上述注释1可以看出，即使该物体和相机不存在公共层，也不影响该物体的 <code>children</code> 显示。这也就解释了上述为什么给 <code>group</code> 设置 <code>layers</code> ，但是平面物体还是能显示出来。从这一点上来看，<code>layers</code> 和 <code>visible</code> 属性在控制物体显示和隐藏的方面是不一样的。</p> <p>和 <code>visible</code> 属性一样，接下来我们看下 <code>Layers</code> 对 <code>Raycaster</code> 的影响。同样我还是看了 <a href="https://link.segmentfault.com/?enc=OuV8WrS29W8a1QQYMfcBow%3D%3D.RoBmQtdMUWNAHhio0vW%2FUgTjGThO39HtTA9WDTLVCCZBa00pcGcveaxs%2F0xPmUHK5uQaHSoMwExIkJ%2BacYycFBuVJAmwzu%2FW8pXMjxDXoCg%3D" target="_blank" rel="noopener noreferrer">Raycaster.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件，但是发现根本就没有 <code>layers</code> 字段。后来，我看了下最新版本 <code>r140</code> 的 <a href="https://link.segmentfault.com/?enc=J0dfE81%2BYRBoRMy%2FFl8fbw%3D%3D.68cdG4B49X%2BKKyVrM7WVR%2FaE9lkDHOQJhzyXGUnp3TxUvl6FXYerY7fk3cMJaverW8r0P%2B4WgtVOLqqwcsA2uCxaaIW0sX4CPLLXCBqerD0%3D" target="_blank" rel="noopener noreferrer">Raycaster.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">intersectObject</span><span class="token punctuation">(</span> <span class="token parameter">object<span class="token punctuation">,</span> raycaster<span class="token punctuation">,</span> intersects<span class="token punctuation">,</span> recursive</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> object<span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span> raycaster<span class="token punctuation">.</span>layers <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注释1：判断物体和Raycaster是否有公共层</span>

object<span class="token punctuation">.</span><span class="token function">raycast</span><span class="token punctuation">(</span> raycaster<span class="token punctuation">,</span> intersects <span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> recursive <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注释1：不管该物体和Raycaster是否有公共层，都不影响children</span>


    <span class="token keyword">const</span> children <span class="token operator">=</span> object<span class="token punctuation">.</span>children<span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>


      <span class="token function">intersectObject</span><span class="token punctuation">(</span> children<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">,</span> raycaster<span class="token punctuation">,</span> intersects<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>不同于前面，<code>visible</code> 和 <code>layers</code> 都可以用来控制物体的显示与隐藏，<code>visible</code> 和 <code>layers</code> <strong>只有</strong>一个可以用来控制 <code>Raycaster</code> 的行为，具体是哪一个生效，可以看下 <a href="https://link.segmentfault.com/?enc=z7xtilXmrgiuPlI9FD%2FETw%3D%3D.M9zzdDft7OICInJSmCWljZbiykVHToW9DeyrSYzRqHP5BPFqxlRGnu7RtewaGfhanRbVx6fcUxxpIYwb4v8StA%3D%3D" target="_blank" rel="noopener noreferrer">Three.js的迁移指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>可以看到，从 <code>r114</code> 版本，废除了 <code>visible</code> ，开始使用 <code>layers</code> 控制 <code>Raycaster</code> 的行为：</p> <blockquote><p>r113 → r114
Raycaster honors now invisible 3D objects in intersection tests. Use the new property Raycaster.layers for selectively ignoring 3D objects during raycasting.</p></blockquote> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>从上面可以看出，<code>visible</code> 和 <code>layers</code> 在控制物体显示与隐藏、<code>Raycaster</code> 是否进行等方面是存在差异的。</p> <p>当该物体的 <code>visible</code> 属性为 <code>false</code> 并且 <code>layers</code> 属性测试失败的时候，行为总结如下：</p> <p><img src="/assets/img/three-04.5edf2449.png" alt="a8e38059d202ed0bda3f3a8b6a4165de.png"></p> <h2 id="clock"><a href="#clock" class="header-anchor">#</a> Clock</h2> <p><code>Clock</code>本质上就是对<code>Date</code>进行封装，提供了一些方法和属性，当你通过Threejs编写一些和时间相关程序时候，不用在对<code>Date</code>进行封装，直接调用<code>Clock</code>对象的方法和属性即可。</p> <p>通过Three.js实现一些动画功能往往需要<code>Clock</code>对象获得一些时间数据，比如骨骼动画、变形动画、粒子动画。</p> <h3 id="getdelta-方法"><a href="#getdelta-方法" class="header-anchor">#</a> <code>.getDelta ()</code>方法</h3> <p><code>.getDelta ()</code>是<code>Clock</code>对象比较常用的方法，默认情况下，简单说<code>.getDelta ()</code>方法的功能就是获得前后两次执行该方法的时间间隔，假设你执行一次<code>.getDelta ()</code>方法，再执行一次<code>.getDelta ()</code>方法，第二次执行<code>.getDelta ()</code>方法时候，可以返回上次调用该方法到本次调用之间的时间间隔，返回间隔时间单位是秒，可以参考下面的代码案例理解。</p> <h3 id="两帧渲染时间间隔"><a href="#两帧渲染时间间隔" class="header-anchor">#</a> 两帧渲染时间间隔</h3> <p>代码功能：下面一段的代码功能就是通过<code>Clock</code>对象的方法<code>.getDelta()</code>获得Threejs本次执行渲染方法<code>.render()</code>和上次执行渲染方法<code>.render()</code>的时间间隔，简单的说就是通过<code>.getDelta()</code>方法获得Three.js两帧渲染时间间隔。</p> <p>阅读下面代码你应该首先对Threejs的渲染方法有一定的概念，Threejs渲染器的渲染方法<code>.render()</code>每执行一次就得到一帧图像，渲染效果也就是图像会显示在Cnavas画布上，如果一个三维场景是不停变化的，肯定要周期性调用执行<code>.render()</code>方法，更新canvas画布显示内容，一帧帧图像随着时间变化，这样就展现出来一个动画效果。为了周期性执行渲染器渲染方法<code>.render()</code>，一般通过浏览器的API<code>requestAnimationFrame</code>实现，浏览器会控制渲染频率，一般性能理想的情况下，每秒<code>s</code>渲染60次左右，在实际的项目中，如果需要渲染的场景比较复杂，一般都会低于60，也就是渲染的两帧时间间隔大于16.67ms。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建一个时钟对象Clock</span>
<span class="token keyword">var</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行渲染方法，渲染出来一帧图像</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//周期性执行渲染函数</span>
  <span class="token comment">//clock.getDelta()方法获得两帧的时间间隔</span>
  <span class="token keyword">var</span> <span class="token constant">T</span> <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回时间单位：秒</span>
  <span class="token comment">// 可以在控制打印查看你的渲染时间间隔</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'两帧渲染时间间隔'</span><span class="token punctuation">,</span><span class="token constant">T</span><span class="token operator">*</span><span class="token number">1000</span><span class="token operator">+</span><span class="token string">'毫秒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'查看每秒渲染频率'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="属性-autostart-boolean"><a href="#属性-autostart-boolean" class="header-anchor">#</a> 属性<code>.autoStart: Boolean</code></h3> <p>如果设置为 true，则在第一次 update 时开启时钟<code>Clock</code>。默认值是 true。</p> <h3 id="属性-starttime-float"><a href="#属性-starttime-float" class="header-anchor">#</a> 属性<code>.startTime : Float</code></h3> <p>存储时钟<code>Clock</code>最后一次调用 start 方法的时间</p> <h3 id="属性-starttime-float-2"><a href="#属性-starttime-float-2" class="header-anchor">#</a> 属性<code>.startTime : Float</code></h3> <p>存储时钟<code>Clock</code>最后一次调用 start, getElapsedTime 或 getDelta 方法的时间。</p> <h3 id="属性-elapsedtime-float"><a href="#属性-elapsedtime-float" class="header-anchor">#</a> 属性<code>.elapsedTime : Float</code></h3> <p>保存时钟<code>Clock</code>运行的总时长。</p> <h3 id="属性-running-boolean"><a href="#属性-running-boolean" class="header-anchor">#</a> 属性<code>.running : Boolean</code></h3> <p>判断时钟<code>Clock</code>是否在运行。</p> <h3 id="方法-start"><a href="#方法-start" class="header-anchor">#</a> 方法<code>.start ()</code></h3> <p>启动时钟。同时将 startTime 和 oldTime 设置为当前时间。 设置 elapsedTime 为 0，并且设置 running 为 true</p> <h3 id="方法-stop"><a href="#方法-stop" class="header-anchor">#</a> 方法<code>.stop ()</code></h3> <p>停止时钟。同时将 oldTime 设置为当前时间。</p> <h3 id="方法-getelapsedtime"><a href="#方法-getelapsedtime" class="header-anchor">#</a> 方法<code>.getElapsedTime ()</code></h3> <p>获取自时钟启动后的秒数，摒弃将 oldTime 设置为当前时间。 如果 autoStart 设置为 true 且时钟并未运行，则该方法同时启动时钟。</p> <h3 id="方法-getdelta"><a href="#方法-getdelta" class="header-anchor">#</a> 方法<code>.getDelta ()</code></h3> <p>获取自 oldTime 设置后到当前的秒数。 同时将 oldTime 设置为当前时间。 如果 autoStart 设置为 true 且时钟并未运行，则该方法同时启动时钟。</p> <h2 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h2> <h3 id="地球绕太阳自转公转"><a href="#地球绕太阳自转公转" class="header-anchor">#</a> 地球绕太阳自转公转</h3> <p><img src="/Volumes/E%E5%8C%BA/vuepress/docs/%E6%8F%92%E4%BB%B6%E5%B0%8F%E6%8A%80%E5%B7%A7/imgs/three-03.png" alt="截屏2023-07-21 15.21.27"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>地球绕太阳转<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c2d<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c2d<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// 官网地址</span>
      <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js'</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/controls/OrbitControls.js'</span>

      <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#c2d'</span><span class="token punctuation">)</span>
      <span class="token comment">// 渲染器</span>
      <span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> canvas<span class="token punctuation">,</span> <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> fov <span class="token operator">=</span> <span class="token number">40</span> <span class="token comment">// 视野范围</span>
      <span class="token keyword">const</span> aspect <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// 相机默认值 画布的宽高比</span>
      <span class="token keyword">const</span> near <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token comment">// 近平面</span>
      <span class="token keyword">const</span> far <span class="token operator">=</span> <span class="token number">1000</span> <span class="token comment">// 远平面</span>
      <span class="token comment">// 透视投影相机</span>
      <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>

      <span class="token comment">// 相机位置</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
      camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token comment">// 控制相机</span>
      <span class="token keyword">const</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
      controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// 纹理加载器</span>
      <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建场景</span>
      <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 添加星空背景，修改背景展示图片纹理。</span>
      <span class="token keyword">const</span> bgTexture <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./img/c8f87a1ea32adff09847c25aaaa9a6fe.jpeg'</span><span class="token punctuation">)</span>
      scene<span class="token punctuation">.</span>background <span class="token operator">=</span> bgTexture

      <span class="token comment">// 添加太阳</span>
      <span class="token comment">// 物体网格对象</span>
      <span class="token keyword">const</span> objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 一球多用</span>
        <span class="token keyword">const</span> radius <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">const</span> widthSegments <span class="token operator">=</span> <span class="token number">36</span>
        <span class="token keyword">const</span> heightSegments <span class="token operator">=</span> <span class="token number">36</span>
        <span class="token keyword">const</span> sphereGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span>radius<span class="token punctuation">,</span> widthSegments<span class="token punctuation">,</span> heightSegments<span class="token punctuation">)</span>

        <span class="token comment">// 太阳</span>
        <span class="token keyword">const</span> sunTexture <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./img/a7053dd646bb89e1b27fe8ac08a4d8f4.jpeg'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sunMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">map</span><span class="token operator">:</span> sunTexture <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sunMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>sphereGeometry<span class="token punctuation">,</span> sunMaterial<span class="token punctuation">)</span>
        <span class="token comment">// 放大3倍</span>
        sunMesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token comment">// scene.add(sunMesh)</span>
        <span class="token comment">// 放入控制对象</span>
        objects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sunMesh<span class="token punctuation">)</span>


        <span class="token comment">// 地球</span>
        <span class="token keyword">const</span> earthTexture <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./img/a282e216f7f48eb6c7db198788858ba3.jpeg'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> earthMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">map</span><span class="token operator">:</span> earthTexture
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> earthMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>sphereGeometry<span class="token punctuation">,</span> earthMaterial<span class="token punctuation">)</span>
        earthMesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">20</span>
        <span class="token comment">// scene.add(earthMesh)</span>
        <span class="token comment">// 放入控制对象</span>
        objects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>earthMesh<span class="token punctuation">)</span>

        <span class="token comment">// 屏蔽掉 太阳加入全局场景</span>
        <span class="token comment">// scene.add(sunMesh) </span>
        <span class="token comment">// 屏蔽掉 地球加入全局场景</span>
        <span class="token comment">// scene.add(earthMesh)</span>

        <span class="token comment">// 太阳系 物体对象</span>
        <span class="token keyword">const</span> solarSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solarSystem<span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>solarSystem<span class="token punctuation">)</span>

        solarSystem<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sunMesh<span class="token punctuation">)</span>
        solarSystem<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earthMesh<span class="token punctuation">)</span>


        <span class="token comment">// 同样的月球要围绕地球转，添加一个地月系到太阳系中旋转。</span>
        <span class="token comment">// earthMesh.position.x = 20</span>
        <span class="token comment">// solarSystem.add(earthMesh)</span>

        <span class="token comment">// 地月系 物体对象</span>
        <span class="token keyword">const</span> landOrbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        landOrbit<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">20</span>
        solarSystem<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>landOrbit<span class="token punctuation">)</span>
        <span class="token comment">// objects.push(landOrbit)</span>

        <span class="token comment">// 月球</span>
        <span class="token keyword">const</span> moonTexture <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'../img/2.jpg'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> moonMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">map</span><span class="token operator">:</span> moonTexture <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> moonMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>sphereGeometry<span class="token punctuation">,</span> moonMaterial<span class="token punctuation">)</span>
        moonMesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        moonMesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">5</span>
        objects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>moonMesh<span class="token punctuation">)</span>

        <span class="token comment">// 加入地月系</span>
        landOrbit<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earthMesh<span class="token punctuation">)</span>
        landOrbit<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>moonMesh<span class="token punctuation">)</span>

      <span class="token punctuation">}</span>


      <span class="token punctuation">{</span>
        <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token number">0xffffff</span>
        <span class="token keyword">const</span> intensity <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token comment">// 创建光源</span>
        <span class="token keyword">const</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> intensity<span class="token punctuation">)</span>
        <span class="token comment">// 光源 加入场景</span>
        scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        time <span class="token operator">*=</span> <span class="token number">0.001</span>
        <span class="token comment">/* 
        1.创建一个球几何体，太阳、地球、月亮都是球形，我们可以公用一个球体。
        2.使用基础材质加载太阳纹理。因为灯光是点光源，发光点在中心，太阳也在中心，使用其他材质是无法接收光源。
        3.太阳比其他球体大，放大3倍。
      */</span>
        <span class="token comment">// 网格对象 旋转</span>
        objects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          obj<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">=</span> time
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 加载渲染器</span>
        renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>

        <span class="token comment">// 开始动画</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 开始渲染</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="球体按轨迹运动-webgl三维场景"><a href="#球体按轨迹运动-webgl三维场景" class="header-anchor">#</a> 球体按轨迹运动_WebGL三维场景</h3> <p>效果图</p> <p><img src="/assets/img/three-02.676825aa.png" alt="截屏2023-07-21 15.20.17"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>第一个three.js文件_WebGL三维场景<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> //隐藏body窗口区域滚动条
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引入three.js三维引擎--&gt;</span>
    <span class="token comment">&lt;!-- &lt;script src=&quot;./3D/example/three.min.js&quot;&gt;&lt;/script&gt; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://threejs.org/build/three.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引入轨道控件OrbitControls.js--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./3D/example/OrbitControls.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">/**
     * 创建场景对象
     */</span>
      <span class="token keyword">var</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/**
     * 创建一个设置重复纹理的管道
     */</span>
      <span class="token keyword">var</span> curve <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CatmullRomCurve3</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token comment">/*是否闭合*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tubeGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TubeGeometry</span><span class="token punctuation">(</span>curve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> texture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'run.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 设置阵列模式为 RepeatWrapping</span>
      texture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
      texture<span class="token punctuation">.</span>wrapT<span class="token operator">=</span><span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
      <span class="token comment">// 设置x方向的偏移(沿着管道路径方向)，y方向默认1</span>
      <span class="token comment">//等价texture.repeat= new THREE.Vector2(20,1)</span>
      texture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tubeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">map</span><span class="token operator">:</span> texture<span class="token punctuation">,</span>
        <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>tubeGeometry<span class="token punctuation">,</span> tubeMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tube<span class="token punctuation">)</span>
      <span class="token comment">/**
     * 创建一个半透明管道
     */</span>
      <span class="token keyword">var</span> tubeGeometry2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TubeGeometry</span><span class="token punctuation">(</span>curve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tubeMaterial2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x4488ff</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tube2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>tubeGeometry2<span class="token punctuation">,</span> tubeMaterial2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tube2<span class="token punctuation">)</span>

      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AxesHelper</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment">//小人box</span>
      <span class="token comment">//geometryP = new THREE.CircleGeometry( 5, 32 );</span>
      geometryP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'geometryP'</span><span class="token punctuation">,</span>geometryP<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> materialP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">,</span><span class="token literal-property property">side</span><span class="token operator">:</span><span class="token constant">THREE</span><span class="token punctuation">.</span>DoubleSide<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
      circleP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span> geometryP<span class="token punctuation">,</span> materialP <span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> circleP <span class="token punctuation">)</span><span class="token punctuation">;</span>
      geometryP<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      circleP<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>circleP<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/**
     * 光源设置
     */</span>
      <span class="token comment">//点光源</span>
      <span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      point<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//点光源位置</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//点光源添加到场景中</span>
      <span class="token comment">//环境光</span>
      <span class="token keyword">var</span> ambient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0x888888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ambient<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/**
     * 相机设置
     */</span>
      <span class="token keyword">var</span> width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span> <span class="token comment">//窗口宽度</span>
      <span class="token keyword">var</span> height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span> <span class="token comment">//窗口高度</span>
      <span class="token keyword">var</span> k <span class="token operator">=</span> width <span class="token operator">/</span> height<span class="token punctuation">;</span> <span class="token comment">//窗口宽高比</span>
      <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">//三维场景缩放系数</span>
      <span class="token comment">//创建相机对象</span>
      <span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrthographicCamera</span><span class="token punctuation">(</span><span class="token operator">-</span>s <span class="token operator">*</span> k<span class="token punctuation">,</span> s <span class="token operator">*</span> k<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置相机位置</span>
      camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置相机方向(指向的场景对象)</span>
      <span class="token comment">/**
     * 创建渲染器对象
     */</span>
      <span class="token keyword">var</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// renderer.setClearColor(0xb9d3ff,1);//设置背景颜色</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//body元素中插入canvas对象</span>

      <span class="token keyword">var</span> progress<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	

      <span class="token comment">// 渲染函数</span>
      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行渲染操作</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用加减法可以设置不同的运动方向</span>
        <span class="token comment">// 设置纹理偏移</span>
        texture<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>x <span class="token operator">-=</span> <span class="token number">0.06</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>progress<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token comment">//停留在管道末端,否则会一直跑到起点 循环再跑</span>
        <span class="token punctuation">}</span>
        progress <span class="token operator">+=</span> <span class="token number">0.0009</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>curve<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">let</span> point <span class="token operator">=</span> curve<span class="token punctuation">.</span><span class="token function">getPoint</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>point<span class="token operator">&amp;&amp;</span>point<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span>
            circleP<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span>point<span class="token punctuation">.</span>y<span class="token punctuation">,</span>point<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建控件对象</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="three-js三维地图可视化"><a href="#three-js三维地图可视化" class="header-anchor">#</a> Three.js三维地图可视化</h3> <h5 id="实现一个简单的three-js三维地图"><a href="#实现一个简单的three-js三维地图" class="header-anchor">#</a> 实现一个简单的Three.js三维地图</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 首先创建一个场景</span>
<span class="token keyword">var</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个渲染器，使用WebGL技术</span>
<span class="token keyword">var</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置渲染器的大小为窗口大小</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将渲染器添加到DOM中</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个立方体作为地图</span>
<span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeGeometry</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 给立方体添加颜色</span>
<span class="token keyword">var</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将几何体和材质组合成一个网格对象</span>
<span class="token keyword">var</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将网格对象添加到场景中</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个摄像机，设置视野和位置</span>
<span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个光源</span>
<span class="token keyword">var</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染器渲染场景和摄像机</span>
renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行代码，我们可以在浏览器中看到一个绿色的立方体，这就是我们实现的一个简单的Three.js三维地图。</p> <h3 id="可视化地图-three-js实现"><a href="#可视化地图-three-js实现" class="header-anchor">#</a> 可视化地图——three.js实现</h3> <h4 id="场景的搭建"><a href="#场景的搭建" class="header-anchor">#</a> 场景的搭建</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">chinaMap</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一步新建一个场景</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 新建透视相机</span>
  <span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第二参数就是 长度和宽度比 默认采纳浏览器  返回以像素为单位的窗口的外部宽度和高度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span>
      <span class="token number">75</span><span class="token punctuation">,</span>
      window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
      <span class="token number">0.1</span><span class="token punctuation">,</span>
      <span class="token number">1000</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置渲染器</span>
  <span class="token function">setRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置画布的大小</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span>
    <span class="token comment">//这里 其实就是canvas 画布  renderer.domElement</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置环境光</span>
  <span class="token function">setLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ambientLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span> <span class="token comment">// 环境光</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ambientLight<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="渲染"><a href="#渲染" class="header-anchor">#</a> 渲染</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//第一步新建一个场景</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//render 办法 </span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="距离设置"><a href="#距离设置" class="header-anchor">#</a> 距离设置</h5> <p><strong>默认状况下，当咱们调用scene.add()的时候，物体将会被增加到(0,0,0)坐标。但将使得摄像机和立方体彼此在一起。为了避免这种状况的产生，咱们只须要将摄像机略微向外挪动一些即可</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 新建透视相机</span>
<span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 第二参数就是 长度和宽度比 默认采纳浏览器  返回以像素为单位的窗口的外部宽度和高度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span>
    <span class="token number">75</span><span class="token punctuation">,</span>
    window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
    <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token number">1000</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">5</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="动态旋转"><a href="#动态旋转" class="header-anchor">#</a> 动态旋转</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//第一步新建一个场景</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x00ff00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cube<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">0.01</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.01</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="地图数据的取得"><a href="#地图数据的取得" class="header-anchor">#</a> 地图数据的取得</h4> <p>把中国地图的数据json拷贝下来</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载地图数据</span>
<span class="token function">loadMapData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FileLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'../json/china.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> jsondata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其实次要的是上面有个经纬度坐标， 其实这个才是我关怀的，有了点能力生成线，最初能力生成立体。 这里波及到一个知识点， <strong>墨卡托投影转换</strong>。 墨卡托投影转换能够把咱们经纬度坐标转换成咱们对应立体的2d坐标。</p> <p>间接用可视化框架——<strong>d3</strong> 它外面有自带的墨卡托投影转换。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 墨卡托投影转换</span>
<span class="token keyword">const</span> projection <span class="token operator">=</span> d3
<span class="token punctuation">.</span><span class="token function">geoMercator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><em>Object3d是three.js 所有的基类, 提供了一系列的属性和办法来对三维空间中的物体进行操纵。能够通过.add( object )办法来将对象进行组合，该办法将对象增加为子对象</em></p> <p>我这里的整个中国是一个大的Object3d，每一个省是一个Object3d，省是挂在中国下的。 而后中国这个Map挂在scene这个Object3d下。 很显著，在three.js 是一个很典型的树形数据结构，我画了张图给大家看下。</p> <p>Scence场景下挂了很多货色， 其中有一个就是Map, 整个地图， 而后每个省份， 每个省份又是由Mesh和lLine 组成的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">generateGeometry</span><span class="token punctuation">(</span><span class="token parameter">jsondata</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化一个地图对象</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 墨卡托投影转换</span>
  <span class="token keyword">const</span> projection <span class="token operator">=</span> d3
  <span class="token punctuation">.</span><span class="token function">geoMercator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  jsondata<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定一个省份3D对象</span>
    <span class="token keyword">const</span> province <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>province<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="生成地图几何体"><a href="#生成地图几何体" class="header-anchor">#</a> 生成地图几何体</h4> <p>Three.shape() 和 THREE.ExtrudeGeometry（） 为什么会用到这个呢？ 我给大家解释下， <strong>首先每一个省份轮廓组成的下标是一个 2d坐标，然而咱们要生成立方体，shape() 能够定义一个二维形态立体。 它能够和ExtrudeGeometry一起应用，获取点，或者获取三角面。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 每个的 坐标 数组</span>
<span class="token keyword">const</span> coordinates <span class="token operator">=</span> elem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates
<span class="token comment">// 循环坐标数组</span>
coordinates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">multiPolygon</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  multiPolygon<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">polygon</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> lineMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>LineBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> lineGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> polygon<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>polygon<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        shape<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      shape<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span>
      lineGeometry<span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token number">4.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> extrudeSettings <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">depth</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bevelEnabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ExtrudeGeometry</span><span class="token punctuation">(</span>
      shape<span class="token punctuation">,</span>
      extrudeSettings
    <span class="token punctuation">)</span>
    <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#2defff'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> material1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#3480C4'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> <span class="token punctuation">[</span>material<span class="token punctuation">,</span> material1<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Line</span><span class="token punctuation">(</span>lineGeometry<span class="token punctuation">,</span> lineMaterial<span class="token punctuation">)</span>
    province<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span>
    province<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>遍历第一个点的的和canvas2d画图其实是截然不同的， 挪动终点， 而后前面在划线， 画出轮廓。而后咱们在这里能够设置拉伸的深度， 而后接下来就是设置材质了。lineGeometry 其实 对应的是轮廓的边线</p> <h4 id="相机辅助视图"><a href="#相机辅助视图" class="header-anchor">#</a> 相机辅助视图</h4> <p>为了不便调相机地位， 我减少了辅助视图， cameraHelper。 而后你回看下屏幕会呈现一个十字架，而后咱们就能够一直地调整相机的地位，让咱们地地图处于画面的地方</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">addHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CameraHelper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>helper<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="减少交互控制器"><a href="#减少交互控制器" class="header-anchor">#</a> 减少交互控制器</h4> <p>当初地图是曾经生成了，然而用户交互感比拟差，这里咱们引入three的OrbitControls 能够用鼠标在画面随便转动，就能够看到立方体的每一个局部了。然而这个办法不在three 的包外面， 得独自引入一个文件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 设置渲染器</span>
<span class="token function">setRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 设置画布的大小</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span>
  <span class="token comment">//这里 其实就是canvas 画布  renderer.domElement（需要更改成canvas的盒子）</span>
  <span class="token comment">// document.body.appendChild(this.renderer.domElement)</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="射线追踪"><a href="#射线追踪" class="header-anchor">#</a> 射线追踪</h4> <p>然而对于我本人而言还是不称心， 我怎么晓得的我点击的是哪一个省份呢，OK这时候就要引入咱们three中十分重要的一个类了，Raycaster 。</p> <blockquote><p>这个类用于进行raycasting（光线投射）。 光线投射用于进行鼠标拾取（在三维空间中计算出鼠标移过了什么物体）。</p></blockquote> <p>咱们能够对canvas监听的onmouseMove 事件，而后 咱们就能够晓得以后挪动的鼠标是抉择的哪一个mesh。然而在这之前，咱们先对每一个province这个对象上减少一个属性来示意他是哪一个省份的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 将省份的属性 加进来</span>
province<span class="token punctuation">.</span>properties <span class="token operator">=</span> elem<span class="token punctuation">.</span>properties
</code></pre></div><p>Ok, 咱们能够引入射线追踪了带入如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setRaycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>mouse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将鼠标地位归一化为设施坐标。x 和 y 方向的取值范畴是 (-1 to +1)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientX <span class="token operator">/</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientY <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> onMouseMove<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过摄像机和鼠标地位更新射线</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为咱们不停地在在画布挪动， 所以须要不停的的射线地位。当初有了射线， 那咱们须要场景的所有货色去比拟了，rayCaster 也提供了办法代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> intersects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">,</span> <span class="token comment">// 场景的</span>
  <span class="token boolean">true</span>  <span class="token comment">// 若为true，则同时也会检测所有物体的后辈。否则将只会检测对象自身的相交局部</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这个intersects失去的穿插很多，然而呢咱们只抉择其中一个，那就是物体材质个数有两个的， 因为咱们下面就是用对mesh用两个材质</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> <span class="token punctuation">[</span>material<span class="token punctuation">,</span> material1<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>所以过滤代码如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过摄像机和鼠标地位更新射线</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
  <span class="token comment">// 算出射线 与当场景相交的对象有那些</span>
  <span class="token keyword">const</span> intersects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> find <span class="token operator">=</span> intersects<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我怎么晓得我到底找到没，咱们对找到的mesh将它的外表变成灰色，然而这样会导致一个问题，咱们鼠标再一次挪动的时候要把上一次的材质给他恢复过来。</p> <p>代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过摄像机和鼠标地位更新射线</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
  <span class="token comment">// 算出射线 与当场景相交的对象有那些</span>
  <span class="token keyword">const</span> intersects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// 复原上一次清空的</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'#2defff'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'#3480C4'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick <span class="token operator">=</span> intersects<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">.</span>object<span class="token punctuation">.</span>material<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看下效果图：</p> <h4 id="减少tooltip"><a href="#减少tooltip" class="header-anchor">#</a> 减少tooltip</h4> <p>为了让交互更加完满，找到了同时在鼠标右下方显示个tooltip，那这个必定是一个div默认是影藏的，而后依据鼠标的挪动挪动相应的地位。</p> <p>第一步新建div</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltip<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第二步设置款式 默认是影藏的</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#tooltip</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>
  <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第三步更改div的地位：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setRaycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>raycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>mouse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'tooltip'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientX <span class="token operator">/</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mouse<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientY <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">// 更改div地位</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">'px'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">'px'</span>
  <span class="token punctuation">}</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> onMouseMove<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最初一步设置tooltip的名字：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">showTip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 显示省份的信息</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> properties <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastPick<span class="token punctuation">.</span>object<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>properties

    <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip<span class="token punctuation">.</span>textContent <span class="token operator">=</span> properties<span class="token punctuation">.</span>name

    <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'visible'</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tooltip<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'hidden'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到这里，整个3d可视化地球我的项目曾经实现了</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/three.js/SpecialEffects.html" class="prev">
        特效效果
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8914b41c.js" defer></script><script src="/assets/js/3.7f8ab6bd.js" defer></script><script src="/assets/js/14.ccd1b44f.js" defer></script>
  </body>
</html>
