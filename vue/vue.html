<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue | Liang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.64852305.css" as="style"><link rel="preload" href="/assets/js/app.8914b41c.js" as="script"><link rel="preload" href="/assets/js/3.7f8ab6bd.js" as="script"><link rel="preload" href="/assets/js/12.127689ae.js" as="script"><link rel="prefetch" href="/assets/js/10.12b4bf37.js"><link rel="prefetch" href="/assets/js/11.986ec194.js"><link rel="prefetch" href="/assets/js/13.528417d2.js"><link rel="prefetch" href="/assets/js/14.ccd1b44f.js"><link rel="prefetch" href="/assets/js/15.df2ae387.js"><link rel="prefetch" href="/assets/js/16.7bbe874c.js"><link rel="prefetch" href="/assets/js/17.4b65eca3.js"><link rel="prefetch" href="/assets/js/18.b4f5604c.js"><link rel="prefetch" href="/assets/js/19.ada119ee.js"><link rel="prefetch" href="/assets/js/2.f7dde802.js"><link rel="prefetch" href="/assets/js/20.d063279a.js"><link rel="prefetch" href="/assets/js/21.d15b3ac7.js"><link rel="prefetch" href="/assets/js/22.5185a1a5.js"><link rel="prefetch" href="/assets/js/23.91b5f7c4.js"><link rel="prefetch" href="/assets/js/24.545bc1fb.js"><link rel="prefetch" href="/assets/js/25.ce0688e9.js"><link rel="prefetch" href="/assets/js/26.14f7ddb2.js"><link rel="prefetch" href="/assets/js/27.1d380883.js"><link rel="prefetch" href="/assets/js/28.84fd7342.js"><link rel="prefetch" href="/assets/js/29.977a10c6.js"><link rel="prefetch" href="/assets/js/30.e27d5c6c.js"><link rel="prefetch" href="/assets/js/31.fef44b40.js"><link rel="prefetch" href="/assets/js/32.3cde5ab7.js"><link rel="prefetch" href="/assets/js/33.2fd0f2f0.js"><link rel="prefetch" href="/assets/js/34.6174b407.js"><link rel="prefetch" href="/assets/js/35.3457d0d3.js"><link rel="prefetch" href="/assets/js/36.c672256a.js"><link rel="prefetch" href="/assets/js/37.c5336199.js"><link rel="prefetch" href="/assets/js/38.f878aa15.js"><link rel="prefetch" href="/assets/js/39.7272608e.js"><link rel="prefetch" href="/assets/js/4.591798d0.js"><link rel="prefetch" href="/assets/js/40.1f5087ab.js"><link rel="prefetch" href="/assets/js/41.d8defd1f.js"><link rel="prefetch" href="/assets/js/42.4decf61e.js"><link rel="prefetch" href="/assets/js/43.1f54a9fb.js"><link rel="prefetch" href="/assets/js/44.05628c46.js"><link rel="prefetch" href="/assets/js/45.b64569a4.js"><link rel="prefetch" href="/assets/js/46.3e758616.js"><link rel="prefetch" href="/assets/js/47.754e4534.js"><link rel="prefetch" href="/assets/js/48.d7707287.js"><link rel="prefetch" href="/assets/js/49.c62b8419.js"><link rel="prefetch" href="/assets/js/5.ae5a8b30.js"><link rel="prefetch" href="/assets/js/50.60fbaa68.js"><link rel="prefetch" href="/assets/js/51.812c8fc9.js"><link rel="prefetch" href="/assets/js/52.bae4e31b.js"><link rel="prefetch" href="/assets/js/53.bdcc492b.js"><link rel="prefetch" href="/assets/js/54.c9eece36.js"><link rel="prefetch" href="/assets/js/55.bec15e04.js"><link rel="prefetch" href="/assets/js/56.3e4a4b07.js"><link rel="prefetch" href="/assets/js/57.300f3929.js"><link rel="prefetch" href="/assets/js/58.9b3bc2f8.js"><link rel="prefetch" href="/assets/js/59.b4f2f65a.js"><link rel="prefetch" href="/assets/js/6.c6d5d1da.js"><link rel="prefetch" href="/assets/js/60.6da1c705.js"><link rel="prefetch" href="/assets/js/61.0f431e1e.js"><link rel="prefetch" href="/assets/js/62.ca980bdb.js"><link rel="prefetch" href="/assets/js/63.b1d0e0d0.js"><link rel="prefetch" href="/assets/js/64.a5dc88b1.js"><link rel="prefetch" href="/assets/js/65.2134e59f.js"><link rel="prefetch" href="/assets/js/66.2ce26325.js"><link rel="prefetch" href="/assets/js/67.be6c5ba6.js"><link rel="prefetch" href="/assets/js/68.5ee46489.js"><link rel="prefetch" href="/assets/js/69.817ef5b5.js"><link rel="prefetch" href="/assets/js/7.39a2feef.js"><link rel="prefetch" href="/assets/js/70.bd026d5e.js"><link rel="prefetch" href="/assets/js/71.94cd51c9.js"><link rel="prefetch" href="/assets/js/72.2852256c.js"><link rel="prefetch" href="/assets/js/73.ff13867e.js"><link rel="prefetch" href="/assets/js/74.d43a4484.js"><link rel="prefetch" href="/assets/js/75.8a138783.js"><link rel="prefetch" href="/assets/js/76.75869419.js"><link rel="prefetch" href="/assets/js/77.85ccf9b3.js"><link rel="prefetch" href="/assets/js/78.d1f93c97.js"><link rel="prefetch" href="/assets/js/79.476c7345.js"><link rel="prefetch" href="/assets/js/8.6aa44381.js"><link rel="prefetch" href="/assets/js/80.75df788e.js"><link rel="prefetch" href="/assets/js/81.8dabfdfb.js"><link rel="prefetch" href="/assets/js/82.b373d124.js"><link rel="prefetch" href="/assets/js/83.543e5130.js"><link rel="prefetch" href="/assets/js/84.551d04d7.js"><link rel="prefetch" href="/assets/js/85.21a99aad.js"><link rel="prefetch" href="/assets/js/9.ab9a5c08.js">
    <link rel="stylesheet" href="/assets/css/0.styles.64852305.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Liang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  vuepress
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/插件小技巧/" class="nav-link">
  插件小技巧
</a></li><li class="dropdown-item"><!----> <a href="/前端问题/" class="nav-link">
  前端问题
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">
  vue问题
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react问题
</a></li><li class="dropdown-item"><!----> <a href="/优化问题/" class="nav-link">
  优化问题
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/regular&amp;git/regular/" class="nav-link">
  正则&amp;git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="画图小软件" class="dropdown-title"><span class="title">画图小软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="画图小软件" class="mobile-dropdown-title"><span class="title">画图小软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/three.js/" class="nav-link">
  three.js
</a></li><li class="dropdown-item"><!----> <a href="/eChart/" class="nav-link">
  eChart
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微前端" class="dropdown-title"><span class="title">微前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微前端" class="mobile-dropdown-title"><span class="title">微前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qiankun/" class="nav-link">
  qiankun
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/progress/" class="nav-link">
  记录问题
</a></li><li class="dropdown-item"><!----> <a href="/小案例/" class="nav-link">
  小案例
</a></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/Lchu3/lchushan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  vuepress
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/插件小技巧/" class="nav-link">
  插件小技巧
</a></li><li class="dropdown-item"><!----> <a href="/前端问题/" class="nav-link">
  前端问题
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">
  vue问题
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react问题
</a></li><li class="dropdown-item"><!----> <a href="/优化问题/" class="nav-link">
  优化问题
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/regular&amp;git/regular/" class="nav-link">
  正则&amp;git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="画图小软件" class="dropdown-title"><span class="title">画图小软件</span> <span class="arrow down"></span></button> <button type="button" aria-label="画图小软件" class="mobile-dropdown-title"><span class="title">画图小软件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/three.js/" class="nav-link">
  three.js
</a></li><li class="dropdown-item"><!----> <a href="/eChart/" class="nav-link">
  eChart
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微前端" class="dropdown-title"><span class="title">微前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微前端" class="mobile-dropdown-title"><span class="title">微前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qiankun/" class="nav-link">
  qiankun
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/progress/" class="nav-link">
  记录问题
</a></li><li class="dropdown-item"><!----> <a href="/小案例/" class="nav-link">
  小案例
</a></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/Lchu3/lchushan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vuex.html" class="sidebar-link">vuex</a></li><li><a href="/vue/vue-router.html" class="sidebar-link">vue-router</a></li><li><a href="/vue/vue+svg.html" class="sidebar-link">vue引入svg图标</a></li><li><a href="/vue/vue.html" aria-current="page" class="active sidebar-link">vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vue.html#vue使用注意" class="sidebar-link">vue使用注意</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vue.html#vue生命周期钩子函数" class="sidebar-link">vue生命周期钩子函数</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#computed和watch区别" class="sidebar-link">computed和watch区别?</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#wacth" class="sidebar-link">wacth</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#v-html会遇到xxs攻击" class="sidebar-link">v-html会遇到xxs攻击</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue/vue.html#vue-element-ui" class="sidebar-link">vue + element ui</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vue.html#form-表单验证" class="sidebar-link">Form 表单验证</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#datepicker-日期选择器" class="sidebar-link">DatePicker 日期选择器</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#upload-上传" class="sidebar-link">Upload 上传</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue/vue.html#vue-vue-i18n" class="sidebar-link">vue + vue-i18n</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#vue-封装-前端-功能的实现" class="sidebar-link">vue 封装 前端 @功能的实现</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#基于contenteditable技术实现-选人功能" class="sidebar-link">基于contenteditable技术实现@选人功能</a></li><li class="sidebar-sub-header"><a href="/vue/vue.html#「多图预警」完美实现一个-功能" class="sidebar-link">「多图预警」完美实现一个@功能</a></li></ul></li><li><a href="/vue/" aria-current="page" class="sidebar-link">vue问题总结</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> vue</h1> <p>vue官网         <a href="https://cn.vuejs.org/" target="_blank" rel="noopener noreferrer">https://cn.vuejs.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="vue使用注意"><a href="#vue使用注意" class="header-anchor">#</a> vue使用注意</h2> <h3 id="vue生命周期钩子函数"><a href="#vue生命周期钩子函数" class="header-anchor">#</a> vue生命周期钩子函数</h3> <p>– beforeCreate :这个时期，this变量还不能使用，在data下的数据，和methods下的方法，watcher中的事件都不能获得到。</p> <p>– created这个时候可以操作vue实例中的数据和各种方法，但是还不能对&quot;dom&quot;节点进行操作。</p> <p>– beforeMounte：在挂载开始之前被调用：相关的 render 函数首次被调用</p> <p>– mounted：挂载完毕，这时dom节点被渲染到文档内，一些需要dom的操作在此时才能正常进行</p> <p>– beforeUpdate：data中数据已经更新完毕，页面视图还未响应更改</p> <p>– updated：数据和视图都更新完毕</p> <p>– beforeDestroy：销毁之前，实例上事件、指令等都可以使用，这里组件没有真正的销毁。</p> <p>– destroyed：数据、指令、等完全销毁</p> <h3 id="computed和watch区别"><a href="#computed和watch区别" class="header-anchor">#</a> computed和watch区别?</h3> <p>computed 是计算属性，依赖其他属性计算值，并且 computed 的值有缓存，只有当计算值变化才会返回内容。
watch 监听到值的变化就会执行回调，在回调中可以进行一些逻辑操作。</p> <h3 id="wacth"><a href="#wacth" class="header-anchor">#</a> wacth</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 处理函数</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="v-html会遇到xxs攻击"><a href="#v-html会遇到xxs攻击" class="header-anchor">#</a> v-html会遇到xxs攻击</h3> <ol><li><p>下载 xss 依赖</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install xss <span class="token operator">--</span>save
</code></pre></div></li> <li><p>main.js中引入xss包并挂载到vue原型上</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> xss <span class="token keyword">from</span> <span class="token string">&quot;xss&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>xss <span class="token operator">=</span> xss<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>在vue.config.js中覆写html指令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
        <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;vue-loader&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">&quot;vue-loader&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>compilerOptions<span class="token punctuation">.</span>directives <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">html</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> directiveMeta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">(</span>node<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;innerHTML&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">xss(_s(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>directiveMeta<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">))</span><span class="token template-punctuation string">`</span></span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> options<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="vue-element-ui"><a href="#vue-element-ui" class="header-anchor">#</a> vue + element ui</h2> <p><a href="https://element.eleme.cn/2.0/#/zh-CN/component/installation" target="_blank" rel="noopener noreferrer">element ui官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="form-表单验证"><a href="#form-表单验证" class="header-anchor">#</a> Form 表单验证</h3> <p><a href="https://element.eleme.cn/2.0/#/zh-CN/component/form" target="_blank" rel="noopener noreferrer">Form 表单 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>当一个 form 元素中只有一个输入框时，在该输入框中按下回车应提交该表单。如果希望阻止这一默认行为，可以在 <code>&lt;el-form&gt;</code> 标签上添加 <code>@submit.native.prevent</code>。</p></div> <h5 id="验证bug原因只有以下两种"><a href="#验证bug原因只有以下两种" class="header-anchor">#</a> 验证bug原因只有以下两种：</h5> <ol><li>没有在data上定义（需要再验证之前定义好表单上的数据）</li> <li>prop和v-model的字段不一致</li></ol> <h5 id="验证例子"><a href="#验证例子" class="header-anchor">#</a> 验证例子：</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rules<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100px<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo-ruleForm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动名称<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动区域<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>region<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.region<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请选择活动区域<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>区域一<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shanghai<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>区域二<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beijing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动时间<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>11<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-date-picker</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>选择日期<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.date1<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-date-picker</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>11<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-time-picker</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fixed-time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>选择时间<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.date2<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-time-picker</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>即时配送<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delivery<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-switch</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.delivery<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-switch</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动性质<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox-group</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>美食/餐厅线上活动<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>地推活动<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>线下主题活动<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>单纯品牌曝光<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox-group</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>特殊资源<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>resource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio-group</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.resource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>线上品牌商赞助<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>线下场地免费<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio-group</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动形式<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleForm.desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitForm('ruleForm')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>立即创建<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>resetForm('ruleForm')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>重置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">ruleForm</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">date1</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">date2</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">delivery</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">''</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请输入活动名称'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'长度在 3 到 5 个字符'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请选择活动区域'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">date1</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请选择日期'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">date2</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请选择时间'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'array'</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请至少选择一个活动性质'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请选择活动资源'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请填写活动形式'</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">submitForm</span><span class="token punctuation">(</span><span class="token parameter">formName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span>formName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">valid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'submit!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error submit!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token parameter">formName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span>formName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>在wacth中调用 $refs 方法，需要在 $nextTick 函数内使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span> <span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            	<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span>formName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></div> <h3 id="datepicker-日期选择器"><a href="#datepicker-日期选择器" class="header-anchor">#</a> DatePicker 日期选择器</h3> <p><a href="https://element.eleme.cn/2.0/#/zh-CN/component/date-picker" target="_blank" rel="noopener noreferrer">DatePicker 日期选择器 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="限制时间的选择"><a href="#限制时间的选择" class="header-anchor">#</a> 限制时间的选择</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-date-picker</span>
                <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data.label<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">value-format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yyyy-MM-dd<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:picker-options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PickerDisabled<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-date-picker</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在vue的data上定义范围</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">PickerDisabled</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//结束时间限制</span>
    <span class="token function-variable function">disabledDate</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> beginVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formInline<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span> <span class="token comment">// this.formInline.startTime：开始时间</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beginVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                time<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>beginVal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">86400000</span> <span class="token operator">||</span>
                time<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不能选择大于今天的日期</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="upload-上传"><a href="#upload-上传" class="header-anchor">#</a> Upload 上传</h3> <p><a href="https://element.eleme.cn/2.0/#/zh-CN/component/upload" target="_blank" rel="noopener noreferrer">Upload 上传 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="vue-vue-i18n"><a href="#vue-vue-i18n" class="header-anchor">#</a> vue + vue-i18n</h2> <p>1.在项目文件src下新建internationalization（自定义）文件夹</p> <p><img src="/assets/img/vue-1.1474c2a7.png" alt="vue-1"></p> <p>2.安装国际化依赖包</p> <div class="language- extra-class"><pre class="language-text"><code>npm i vue-i18n -S
</code></pre></div><p>3.在internationalization（自定义）文件夹下新建文件 en.js、zh.js、index.js</p> <p><img src="data:image/png;base64,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" alt="vue-1"></p> <p>4.在上述index.js文件中，写入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueI18n <span class="token keyword">from</span> <span class="token string">'vue-i18n'</span>
<span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token keyword">import</span> elementEnLocale <span class="token keyword">from</span> <span class="token string">'element-ui/lib/locale/lang/en'</span> <span class="token comment">// element-ui lang</span>
<span class="token keyword">import</span> elementZhLocale <span class="token keyword">from</span> <span class="token string">'element-ui/lib/locale/lang/zh-CN'</span><span class="token comment">// element-ui lang</span>
<span class="token keyword">import</span> enLocale <span class="token keyword">from</span> <span class="token string">'./en'</span>
<span class="token keyword">import</span> zhLocale <span class="token keyword">from</span> <span class="token string">'./zh'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueI18n<span class="token punctuation">)</span>

<span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">en</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>enLocale<span class="token punctuation">,</span>
        <span class="token operator">...</span>elementEnLocale
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">zh</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>zhLocale<span class="token punctuation">,</span>
        <span class="token operator">...</span>elementZhLocale
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chooseLanguage <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'zh-CN'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前语言'</span><span class="token punctuation">,</span>chooseLanguage<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chooseLanguage<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>chooseLanguage <span class="token operator">===</span> <span class="token string">'zh-CN'</span> <span class="token operator">?</span> <span class="token string">'zh'</span> <span class="token operator">:</span> <span class="token string">'en'</span><span class="token punctuation">)</span>

    <span class="token comment">// if has not choose language</span>
    <span class="token keyword">const</span> language <span class="token operator">=</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>language <span class="token operator">||</span> navigator<span class="token punctuation">.</span>browserLanguage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> locales <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> locale <span class="token keyword">of</span> locales<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>language<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>locale<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> locale
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">'en'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueI18n</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// set locale</span>
    <span class="token comment">// options: en | zh | es</span>
    <span class="token literal-property property">locale</span><span class="token operator">:</span> <span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// set locale messages</span>
    messages
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> i18n
</code></pre></div><p>5.在上述zh.js/en.js文件中分别写入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">wisdomLightingSystem</span><span class="token operator">:</span> <span class="token string">'智慧照明系统'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">projectLog</span><span class="token operator">:</span> <span class="token string">'项目日志'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">wisdomLightingSystem</span><span class="token operator">:</span> <span class="token string">'Wisdom Lighting'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">projectLog</span><span class="token operator">:</span> <span class="token string">'Project Log'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>6.在全局的main.js文件中引入</p> <p><img src="/assets/img/vue-3.30ed0cf7.png" alt="vue-1"></p> <p><img src="/assets/img/vue-4.301e25f8.png" alt="vue-1"></p> <p>7.在页面内使用</p> <p><img src="data:image/png;base64,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" alt="vue-1"></p> <p>8.关于路由导航的国际化（这里是我自己的配置，仅供参考）</p> <p><img src="/assets/img/vue-6.6aa23213.png" alt="vue-1"></p> <p><img src="/assets/img/vue-7.fdedc07b.png" alt="vue-1"></p> <p><img src="/assets/img/vue-8.60393ef1.png" alt="vue-1"></p> <p>9.最终结果</p> <p><img src="/assets/img/vue-9.da283600.png" alt="vue-1"></p> <h2 id="vue-封装-前端-功能的实现"><a href="#vue-封装-前端-功能的实现" class="header-anchor">#</a> vue 封装 前端 @功能的实现</h2> <p>在输入框中输入@后，弹出选人的浮框，然后选择人（可多选），选完后，关闭浮框，然后在输入框中加入@XXX，然后焦点定位刚开始输入@的位置。删除的时候，@XXX要一块删除。
分析：
1.因为要在输入框中把@xxx高亮显示，所以需要用到可编辑元素。</p> <div class="language- extra-class"><pre class="language-text"><code> &lt;div contentEditable&gt;&lt;/div&gt;
</code></pre></div><p>2.用到selection和range对象</p> <p>开撸：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
     <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.talkInput}</span> 
     <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>talkInput<span class="token punctuation">&quot;</span></span> 
     <span class="token attr-name">contentEditable</span>
     <span class="token special-attr"><span class="token attr-name">onKeyDown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token punctuation">{</span>onTalkKeyDown<span class="token punctuation">}</span></span></span></span>
     <span class="token attr-name">onInput</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{changeTalkContent}</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">changeTalkContent</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTalkContent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//监听输入@</span>
        <span class="token function">openSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">openSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//打开选人浮层</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'share/update'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">visible</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建selection,用法可以直接去MDN 去查看 https://developer.mozilla.org/zh-CN/docs/Web/API/Selection</span>
    <span class="token function">setFocusNode</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 缓存光标所在节点</span>
    <span class="token function">setFocusOffset</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusOffset<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 缓存光标所在节点位置</span>
    <span class="token keyword">let</span> inputId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'talkInput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inputId<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>选完人后</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">onSelectSubmit</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//val 选择的人的信息</span>
    <span class="token keyword">let</span> userList <span class="token operator">=</span> val<span class="token punctuation">.</span>sharedUserIds<span class="token punctuation">;</span>
    <span class="token function">setDirectUsers</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>directUsers<span class="token punctuation">,</span> <span class="token operator">...</span>userList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> inputId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'talkInput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//选中输入的@符号</span>
    range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>focusNode<span class="token punctuation">,</span> focusOffset <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>focusNode<span class="token punctuation">,</span> focusOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//删除输入的@符号</span>
    range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> spanNode1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> spanNode2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        spanNode1<span class="token punctuation">.</span>className <span class="token operator">=</span> styles<span class="token punctuation">.</span>atFont<span class="token punctuation">;</span>
        spanNode1<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'@'</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>nickName<span class="token punctuation">;</span>
        spanNode1<span class="token punctuation">.</span>contentEditable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//设置为不可编辑，是为了整个@xxx一起删掉</span>
        spanNode1<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-userId'</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        spanNode2<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&amp;nbsp;'</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            node<span class="token punctuation">,</span>
            lastNode<span class="token punctuation">;</span>
        frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>spanNode1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在 Range 的起点处插入一个节点。</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">=</span> spanNode2<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lastNode <span class="token operator">=</span> frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        selection<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>lastNode<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        selection<span class="token punctuation">.</span><span class="token function">collapseToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将当前的选区折叠到最末尾的一个点。</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>删除@xxx的时候，要把@xxx一起删除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">onTalkKeyDown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> inputId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'talkInput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> delUserId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        canDel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">'Backspace'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//按下删除键时</span>
        <span class="token keyword">let</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> removeNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//焦点在@xxx后面的时候</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>startOffset <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> range<span class="token punctuation">.</span>startContainer<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'atFont'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            removeNode <span class="token operator">=</span> range<span class="token punctuation">.</span>startContainer<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//  点一下@xxx的时候，直接删除@xxx的时候，此时range.startContainer是@xxx,range.startContainer.parentElement是&lt;span&gt;@xxx&lt;/span&gt;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>startContainer<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'atFont'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            removeNode <span class="token operator">=</span> range<span class="token punctuation">.</span>startContainer<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>removeNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            delUserId <span class="token operator">=</span> removeNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-userid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            inputId<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>removeNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> userList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>directUsers<span class="token punctuation">]</span><span class="token punctuation">,</span>
            newUserList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>canDel <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">.</span>userId <span class="token operator">===</span> delUserId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                canDel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                newUserList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>newUserList<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>s <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setDirectUsers</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>newUserList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>结束。</p> <h2 id="基于contenteditable技术实现-选人功能"><a href="#基于contenteditable技术实现-选人功能" class="header-anchor">#</a> 基于contenteditable技术实现@选人功能</h2> <p>@功能，是一个“看起来简单”，实际上“要考虑特别多问题” 的功能需求。本文对这个常见的功能需求的实现进行了记录。</p> <p>之前我在小程序里在没有 contenteditable 的input中实现了一个输入 @ 字符实现 at 选人功能的需求。无米之炊: 小程序内实现一个具有“@功能at功能”的输入框。当时由于小程序缺少富文本输入框，因此只能在纯 input 里面实现人名输入和用户信息还原。</p> <p>如今咱们就要来实现 web 的版本了。web 端具有更加丰富的 api 给我们使用，但是其考虑的问题也会更多，因为web端用户的输入变换莫测(即用户可以使用鼠标、键盘或其他输入设备随意的选择、粘贴、控制文本框)。因此，web端如果采用拦截用户所有输入情况进行 &quot;虚拟抽象层&quot; 处理和渲染会有些力不从心。</p> <p>本文最终还是采用通用的方案---contenteditable来实现，下面介绍其过程和思路。</p> <p>明确需求</p> <p>要做这个需求，我们需要首先明确 at功能需求 其本质上要包含哪些必要的功能以及一些特定的前置条件，这会直接影响到我们技术方案的设计。</p> <p>前置条件明确</p> <p>我们需要向产品确认联系人中是否有 “重名” 的联系人，如联系人中是否会有 2 个叫做 “小明” 的联系人。</p> <p>如果不会重名，我们便可以使用一种 “类似新浪微博” 的方案，即无需管理和记录每个人的真实id，只需让用户在文本框内随意选择和输入文本和人名，等到最后用户点击保存提交微博时，将文本框内的字符串依次遍历反解(反解办法就是，先找到一个@字符作为开始，然后直到碰到一个空格作为结束，看一下该字符串是否等于某个人名账号)。</p> <p>由于新浪微博他的人名(账户)是唯一的，因此他便采用了如上简便的做法。从我们随意输入和粘贴一段文本之后产生的bug来看，的确如此：</p> <p>以上是我通过鼠标@或者文本输入插入了一些 齐鲁晚报 的人名。但是当我主动把其中某些字符删掉，或者把 &quot;@齐鲁晚报&quot; 后方的空格干掉，提交后微博便无法还原我at的人了。图上每个人名我都无法hover或点击(因为我破坏了人名反解的结构)。</p> <p>但是，如果我从其他地方拷贝一个 &quot;@齐鲁晚报&quot; 的字符串，然后在其后方敲入一个空格，再提交，则微博可以获取到该用户。</p> <p>因此，我们猜到新浪微博反解人名的办法是：寻找@字符及其后方的空格作为一个人名。我们查看新浪微博dom中是通过textarea实现的输入框，通过其 api限制以及上面的效果来看，其原理就是如我们所猜测的一样：基于输入内容的字符串进行反解而已，思路比较简单。</p> <p>而本文我所面向的需求前置条件是：联系人具有可重复的人名。此时的技术方案便面临一个最大的问题：如何能反解出输入框中人名的信息？举例来说：假如我们输入框中的字符串内容是 &quot;你好，@小明，我们一起吃饭吧，你叫上另外一个 @小明&quot;。 那么，提交给后台存储时，我们比如告知后台第一个小明是1号小明，第二个小明是2号小明。如何做到呢？这个我们在下文讲述。</p> <p>需求定义</p> <p>OK，我们来基于 “人名可以重复” 这个前置条件，来定义一下我们的需求。用户可以在文本框中输入任意的普通字符</p> <p>用户可以通过输入一个 &quot;@&quot; 字符来调起一个选人浮层，选人浮层的位置必须放置在光标所在的位置，且能够根据窗口边缘进行适当的位置调整。例如下方空间不够时，则放到上方。我们来看看新浪微博：</p> <p>这个是默认下方空间够用的时候。当下方不够时，浮层会出现在上方：</p> <p>但是，经过测试，当右侧空间不够时，它并没有出现在左方：</p> <p>理论上，最好的方案应该是：左上、左下、右上、右下每个方向都可以放置浮层，如果任何一个位置空间不够，则换一个位置放置。其放置也是有优先级的，例如右下方和右上方同时都能放下，则右下方优先级更高。其优先级顺序应该是：右下方、右上方、左下方、左上方。</p> <p>当选人浮层出现后，用户可以通过键盘的“上”、“下”来操纵选人浮层上对应的人选，并可以通过“回车键”将人选填入到输入框中。当然，也可以支持鼠标选择。</p> <p>输入框中的人名是一个整体。即：当用户鼠标在输入框中人名附近左右移动时，光标不能放置到人名中间。同时，用户在人名后方按下“退格”键，则会把当前人名整体瞬间删除。</p> <p>支持模糊搜索。即：当用户输入 @ 时，弹出推荐的联系人，当他输入 &quot;@小&quot;，则浮层里要把 &quot;小明&quot; &quot;小红&quot; &quot;小x&quot; 等搜索后的联系人。 且选人完毕后，要把选中的如 &quot;小红&quot; 填入到文本框中</p> <p>用户输入完毕后，可以把文本框中所有字符串或人名转成对应的结构存储到后端存储。从而在其他页面可以展示。例如QQ空间发表说说后，后台需要给你输入的人名发送at通知，而且要在你的qq说说页面展示你发表的内容(当你鼠标放到人名上还可以展示用户卡片)，如图：</p> <p>技术上要考虑的点：</p> <p>需求看起来简单，实际上这个功能是个前端大坑。我们看看这涉及到多少个要考虑的点，每个点都不是那么简单：如何能反解出输入框中人名的信息</p> <p>后台提交接口该如何设计</p> <p>人名检索接口设计。用户键入关键字后，要通过搜索接口实时拉取人名，api接口该如何设计</p> <p>如何检测@字符。如何区分是出默认人选还是按输入模糊检索。</p> <p>选人后如何替换掉原来的检索文案。</p> <p>选人浮层的定位。如何定位光标位置，如何将浮层放置在页面中最合适的位置；当浮层还没渲染时，如何知道浮层宽高从而进行位置选择</p> <p>中文输入bug。中文输入时，编辑器内会先出现拼音，等用户按“空格”或“回车”后变成中文，应该如何处理这种场景</p> <p>如何实现整个人名一次性删除</p> <p>人名隔离问题。即如何确保输入人名之后，再输入其他字符时自动产生一个新的textNode类型的节点，而不是插入到人名标签中</p> <p>placeholder 怎样实现</p> <p>粘贴操作的处理。当用户粘贴富文本时，我们要不允许其粘贴或者将其粘贴内容转成纯文本。</p> <p>下面我们依次来说明如何基于 Web前端 来说实现一个具有完整at功能的输入框。</p> <p>行业洞察</p> <p>我们来瞅瞅行业里别人是咋做的。</p> <p>新浪微博</p> <p>微博是通过一个纯的 textarea 来实现的at功能。我们可以看到，他输入的人名就是一个纯字符串，且我们可以把光标放置到人名中间，甚至我们可以删掉人名中的某个字符，从而破坏掉人名：</p> <p>因此，他的实现是 “仅仅将用户所选的用户id放到输入框对应位置”。他也无须对输入框中的人名建立一个用户信息的记录映射，因为他的场景比较特殊：它at出来的每个人名都是一个唯一id。所以，当他把输入框文本提交给后台时，也无须做任何处理，直接提交即可。后台可以根据字符串中的 “@” 和 “@后方的空格” 找出每个 “所谓的人名” 然后检索数据库找出其对应的用户信息。</p> <p>通常这种at功能还存在一个“中文输入法”的坑，就是如果你输入中文，那么此时输入法会先将拼音放置到输入框，然后等你选词完毕后再把中文换到输入框，这会带来at功能的bug。我们看看新浪微博是咋处理的：在中文输入法输入时，新浪微博为了避免我们后文提到的诡异问题，它直接屏蔽掉了中文输入时的检索能力哈哈。如图，输入中文时并不会触发选人的搜索。</p> <p>QQ空间</p> <p>qq空间是用 contenteditable 的div来实现的。他把用户信息藏到了一个标签里。如图文本框中有2个同名的 catting，但他们分别是2个不同的用户。 由于空间是使用 contenteditable 实现的输入框，因此其人名通过 button 标签给包裹起来了，于是它把每个用户的id等信息藏到了button标签中。</p> <p>QQ空间怎么处理中文输入法问题的呢，我们看看：</p> <p>恩，他直接在有输入法弹窗的情况下，不允许你通过键盘操纵选人面板，也就不存在互相影响的问题了，也是机智。</p> <p>再看看 QQ 空间的 placeholder 是怎么实现的呢？我们看看他的输入框dom：</p> <p>发现这里有个div里放置了placeholder的内容，盖在输入框上面。该dom跟输入框div并列。当我们鼠标点击placeholder位置的时候，意味着我们打算开始输入，这时他把placeholder div隐藏，并主动聚焦到输入框的div里面，从而实现了placeholder效果。</p> <p>由于我们的需求背景存在人名重复，因此无法采用新浪微博这种 “基于字符串解析反解” 的方案，而必须采用类似 QQ空间的 contenteditable 藏信息的方案。下面我们来分别看上文提到的各个技术点如何各个击破。</p> <p>如何能反解出输入框中人名的信息</p> <p>前文我们已经分析了能面向“人名重复”场景的解决方案，只有如下2个办法：拦截用户的输入，搞一个 虚拟抽象层，像我之前做的 小程序方案一样，维持一个特殊的内存结构。</p> <p>使用 contenteditable 的富文本输入框作为输入区域。这样可以将每个人的用户信息藏到文本框里的人名标签里。例如使用span或button包裹人名。</p> <p>第一种方案比较适合小程序场景下输入模式比较单一，只有虚拟键盘的输入；对于PC端用户输入模式多样的情况来说，实现难度极大。因此，我们采用方案2这种比较主流和简便的方案---把用户信息藏到标签里。</p> <p>举个栗子：你在输入框中输入了 “你好 @小明”。 那么在 contenteditable 的输入框中其实是：</p> <p>你好, @小明
这样，我们拿到输入框内部的innerHTML后，可以轻松的拿到每个at人名的个人信息。</p> <p>于是我设计了一个 AtEditor 的Vue组件，其 template 部分是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>ref=&quot;jsEditorElement&quot;

contenteditable=&quot;true&quot;

:class=&quot;[placeholderClass]&quot;

@keyup=&quot;onInputText&quot;

@keydown=&quot;onInputKeyDown&quot;

@blur=&quot;onCloseDialog&quot;

@mouseup=&quot;doToggleDialog&quot;

@paste=&quot;doOnPaste&quot;

&gt;

{{(item.name)}}
</code></pre></div><p>其中jsEditorElement就是输入框，设置其contenteditable为ture，同时绑定好了各种事件进行后续的逻辑处理。</p> <p>其中jsDialogElement就是选人的浮层，通过visibility样式控制他是否展示，通过atDialogPos样式控制他的fixed定位的top和left坐标。</p> <p>后台提交接口设计</p> <p>当用户输入完毕，点击提交或保存时，我们的需求通常需要把文本框内部的文本和人名提取出来，且按序提交给后端存储。例如你空间或微博发布的每一条说说都要存储到后台数据库。那么，这里的接口我们可以将输入框内容抽象成1种消息结构，且该结构有2种类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span> <span class="token comment">// type可以是at类型也可以是text类型</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>例如依然是 “你好，@小明” 这样的输入。那么我们提交给后台时，其数据结构是这样的:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> postMsgs <span class="token operator">=</span> <span class="token punctuation">[</span>

    <span class="token punctuation">{</span>

        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>

        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'你好，'</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">{</span>

        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'at'</span><span class="token punctuation">,</span>

        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'小明'</span><span class="token punctuation">,</span>

            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">]</span>
</code></pre></div><p>人名检索接口设计</p> <p>这里，我们是采用了2个不同的接口来分别实现 “获取推荐的几个联系人” 和 “根据用户输入的内容来搜索匹配的联系人”。因此，我们有如下2个接口：</p> <div class="language- extra-class"><pre class="language-text"><code>getDefaultUsers

@paramslimit: 限制最大返回的联系人数量

@returnpersons: [

{ name: '小明', id: 1 },

{ name: '小红', id: 2 }

]

getSearchUsers

@paramslimit: 限制最大返回的联系人数量

keyword: 用户在@后方输入的用来搜索的文本

@returnpersons: [

{ name: '小明', id: 1 },

{ name: '小红', id: 2 }

]
</code></pre></div><p>这里实际上也可以使用一个接口来实现。例如无论用户 “只输入了@”，还是输入了 &quot;@小&quot; 都通过 getSearchUsers来调用，即只输入@时的keyword是空。</p> <p>at字符和输入的检测</p> <p>其实这里也比较复杂，我们不止要对 @ 字符做出特殊的反应。我们有多种不同的输入都要做出特殊的反应，如：当用户输入 @ 时，我们要调起默认选人</p> <p>当用户输入@，且后方跟着大于等于1个字符时，要调起搜索选人</p> <p>当用户鼠标点击到某个字符处，要判断光标前方字符是否有 @，且区分是调起默认选人还是搜素选人</p> <p>当用户键盘键入 “上箭头” “下箭头” 时，要将行为拦截并转换成对选人浮层人选的上下切换</p> <p>当用户输入“回车”时，要拦截并转换成对选人浮层人选的确认操作</p> <p>当用户输入“ESC返回”时，要转成对选人浮层的关闭操作</p> <p>如上这些，我们主要是监听用户的 “keydown” 和 “keyup” 事件来做的。</p> <p>之所以有些在 keydown里做，有些在keyup里做，是因为在keyup发生的时候，用户的文字已经输入到文本框了，所以这个事件比较适合检测@字符。但是像有些按键我们是不期望他默认行为发生的，因此我需要在 keydown 的时候就拦截掉，例如回车、上下箭头。</p> <p>先来看，键盘事件keydown我是如何拦截的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 键盘按下</span>

<span class="token function">onInputKeyDown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token string">'ArrowDown'</span> <span class="token operator">||</span> e<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'ArrowUp'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// 上下移动光标，用于调整 dialog 里的人</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token string">'ArrowDown'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex<span class="token operator">++</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lists<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lists<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token string">'ArrowUp'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex<span class="token operator">--</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> <span class="token number">0</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

            <span class="token function">preventAfterAction</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// 如果有弹窗，则代表确认选人</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">false</span>

            <span class="token function">preventAfterAction</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectPerson</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lists<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'Escape'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">false</span>

            <span class="token function">preventAfterAction</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token comment">// 回车给拦掉，什么都不做</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token function">preventAfterAction</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">preventAfterAction</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>preventKeyUp <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>再来看 keyup 我是如何检测 @ 的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 按键弹起</span>

<span class="token function">onInputText</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>preventKeyUp<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>preventKeyUp <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>preventKeyUp <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">const</span> el <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget

    <span class="token comment">// 这是输入了@，那就直接弹选人浮层</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token string">'Digit2'</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showDefaultDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token comment">// 这里是输入的不是@，但是可能前方有@，因此需要进行检测看看是否要展示选人浮层</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doToggleDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>来看看</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">doToggleDialog</span><span class="token operator">:</span><span class="token function">doToggleDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> rangeInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEditorRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rangeInfo <span class="token operator">||</span> <span class="token operator">!</span>rangeInfo<span class="token punctuation">.</span>range <span class="token operator">||</span> <span class="token operator">!</span>rangeInfo<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token keyword">const</span> curNode <span class="token operator">=</span> rangeInfo<span class="token punctuation">.</span>range<span class="token punctuation">.</span>endContainer

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curNode <span class="token operator">||</span> curNode<span class="token punctuation">.</span>nodeName <span class="token operator">!==</span> <span class="token string">'#text'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token keyword">const</span> searchStr <span class="token operator">=</span> curNode<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rangeInfo<span class="token punctuation">.</span>selection<span class="token punctuation">.</span>focusOffset<span class="token punctuation">)</span>

    <span class="token comment">// 判断光标位置前方是否有at，只有一个at则展示默认dialog，除了at还有关键字则展示searchDialog</span>

    <span class="token keyword">const</span> keywords <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@([^@]*)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>searchStr<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>keywords <span class="token operator">&amp;&amp;</span> keywords<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 展示搜索选人</span>

        <span class="token keyword">const</span> key_words <span class="token operator">=</span> keywords<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

        <span class="token keyword">const</span> allMathStr <span class="token operator">=</span> keywords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>allMathStr <span class="token operator">===</span> <span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showDefaultDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showSearchDialog</span><span class="token punctuation">(</span>key_words<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        <span class="token comment">// 重点：记下弹窗前光标位置range</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>editorRange <span class="token operator">=</span> rangeInfo

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token comment">// 关掉选人</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">closeDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>这里其实就是检测本次输入完字符后，光标前方是否有@，如果只有一个@就展示默认推荐人，如果是 &quot;@xxx&quot; 这样的结构，则用xxx去检索推荐人。</p> <p>showSearchDilaog的代码我就不贴了，其实就是查询接口，拿到返回的人选列表，放到当前 Vue 的lists字段上。这里贴一下 getEditorRange的代码，他是用户获取当前光标选取的信息(即在弹出选人之前，把输入框中此刻的光标位置先记下来)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getEditorRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> selection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span>getRangeAt <span class="token operator">&amp;&amp;</span> selection<span class="token punctuation">.</span>rangeCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">{</span>

                range<span class="token punctuation">,</span>

                selection<span class="token punctuation">,</span>

            <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>选人浮层的定位。</p> <p>上文解决了浮层何时弹，现在就要解决浮层要弹在哪里的问题。我们需要在浮层isSHow设置为 true之前，就要算出把浮层放在哪里。这里我们首先要解决俩问题：如何在浮层渲染之前知道当前浮层的宽高。因为我们要计算浮层边缘跟整个window窗口的边界，从而找到最合适的放置位置。</p> <p>如何知道当前光标的位置。因为我们的浮层必然是像一个气泡一样，以光标位置为起点展示的。</p> <p>对于第一个问题，基于 vue 的 nextTick 来实现即可，因为 nextTick是在vue的异步dom更新队列之后执行的，此时dom已经更新(同时我们的dialog是基于visibility实现隐藏的，因此其宽高我们实际上是能拿到的)。</p> <p>对于第二个问题，业界通常是使用一个隐藏标签来重放输入框内容从而计算位置。我们这里直接使用了一个现成的类库：http://ichord.github.io/Caret...</p> <p>以下是 <em>showDialog 函数的具体实现：</em></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">showDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 先隐藏</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token comment">// 等隐藏完毕，且最新lists数据dom生成后，可基于此时的dom去获取最新的dialog宽高和坐标</span>

        <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'jsEditorElement'</span><span class="token punctuation">]</span>

        <span class="token keyword">const</span> jsDialogElement <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'jsDialogElement'</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token keyword">const</span> caret <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">caret</span><span class="token punctuation">(</span><span class="token string">'offset'</span><span class="token punctuation">)</span>

        <span class="token keyword">var</span> realPosition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getAdapterPosition</span><span class="token punctuation">(</span>caret<span class="token punctuation">,</span> jsDialogElement<span class="token punctuation">)</span> <span class="token comment">// 获取正确的放置坐标，防止超出边界。本文基于offset</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>atDialogPos <span class="token operator">=</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">left</span><span class="token operator">:</span> realPosition<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>

            <span class="token literal-property property">top</span><span class="token operator">:</span> realPosition<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token string">'px'</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>activeIndex <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 此时再展示出来</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>接下来的问题：如何将浮层放置在页面中最合适的位置。前文我们已经说了这个放置的大致最佳策略。即：左上、左下、右上、右下每个方向都可以放置浮层</p> <p>如果任何一个位置空间不够，则换一个位置放置。</p> <p>其放置也是有优先级的，例如右下方和右上方同时都能放下，则右下方优先级更高。其优先级顺序应该是：右下方、右上方、左下方、左上方。</p> <p>我是4个方向依次试探来实现的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">_getAdapterPosition</span><span class="token punctuation">(</span><span class="token parameter">caret<span class="token punctuation">,</span> dialogElem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> fixHeightGap <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    caret<span class="token punctuation">.</span>top <span class="token operator">=</span> caret<span class="token punctuation">.</span>top <span class="token operator">-</span> fixHeightGap

    caret<span class="token punctuation">.</span>height <span class="token operator">=</span> caret<span class="token punctuation">.</span>height <span class="token operator">+</span> fixHeightGap <span class="token operator">+</span> <span class="token number">5</span>

    <span class="token keyword">const</span> clientWidth <span class="token operator">=</span> document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>clientWidth

    <span class="token keyword">const</span> clientHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>clientHeight

    <span class="token keyword">const</span> toClientLeft <span class="token operator">=</span> caret<span class="token punctuation">.</span>left

    <span class="token keyword">const</span> toClientTop <span class="token operator">=</span> <span class="token punctuation">(</span>caret<span class="token punctuation">.</span>top <span class="token operator">-</span> document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span>

    <span class="token keyword">const</span> toClientRight <span class="token operator">=</span> clientWidth <span class="token operator">-</span> toClientLeft

    <span class="token keyword">const</span> toClientBottom <span class="token operator">=</span> clientHeight <span class="token operator">-</span> toClientTop

    <span class="token keyword">const</span> dialogSize <span class="token operator">=</span> <span class="token punctuation">{</span>

        <span class="token literal-property property">height</span><span class="token operator">:</span> dialogElem<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">,</span>

        <span class="token literal-property property">width</span><span class="token operator">:</span> dialogElem<span class="token punctuation">.</span>offsetWidth

    <span class="token punctuation">}</span>

    <span class="token comment">// 看是否可放右侧下方 (原点要从光标下方开始算起, 因此toClientBottom要加一下光标高度)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>toClientBottom <span class="token operator">-</span> caret<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>toClientRight <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">top</span><span class="token operator">:</span> toClientTop <span class="token operator">+</span> caret<span class="token punctuation">.</span>height<span class="token punctuation">,</span>

            <span class="token literal-property property">left</span><span class="token operator">:</span> toClientLeft

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>toClientTop <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>toClientRight <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">top</span><span class="token operator">:</span> toClientTop <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">,</span>

            <span class="token literal-property property">left</span><span class="token operator">:</span> toClientLeft

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>toClientBottom <span class="token operator">-</span> caret<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>toClientLeft <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">top</span><span class="token operator">:</span> toClientTop <span class="token operator">+</span> caret<span class="token punctuation">.</span>height<span class="token punctuation">,</span>

            <span class="token literal-property property">left</span><span class="token operator">:</span> toClientLeft <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>width

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>toClientTop <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>toClientLeft <span class="token operator">&gt;=</span> dialogSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>

            <span class="token literal-property property">top</span><span class="token operator">:</span> toClientTop <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>height<span class="token punctuation">,</span>

            <span class="token literal-property property">left</span><span class="token operator">:</span> toClientLeft <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>width

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> left <span class="token operator">=</span> toClientLeft <span class="token operator">&gt;</span> toClientRight <span class="token operator">?</span> toClientLeft <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>width <span class="token operator">:</span> toClientLeft

        <span class="token keyword">let</span> top <span class="token operator">=</span> toClientTop <span class="token operator">&gt;</span> toClientBottom <span class="token operator">?</span> toClientTop <span class="token operator">-</span> dialogSize<span class="token punctuation">.</span>height <span class="token operator">:</span> toClientTop <span class="token operator">+</span> caret<span class="token punctuation">.</span>height

        <span class="token keyword">return</span> <span class="token punctuation">{</span>

            top<span class="token punctuation">,</span>

            left

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> caret

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>如何实现整个人名一次性删除</p> <p>这里可以很复杂，也可以很简单。最简单的方案就是业界通常使用的 button 标签，尤其是 chrome 内核的浏览器，button标签方案是比较兼容的。我们可以将人名对应的用户信息 塞到 button 标签当中。但为了能在退格的时候将他整体删除且不能随意修改，我们通常对 button 标签再加点料：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>

btn<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>

btn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

btn<span class="token punctuation">.</span>contentEditable <span class="token operator">=</span> <span class="token boolean">false</span>

btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

btn<span class="token punctuation">.</span>tabindex <span class="token operator">=</span> <span class="token string">'-1'</span>
</code></pre></div><p>选人后如何替换掉原来的检索文案。</p> <p>在弹出选人浮层的时候onToggleDialog中 ，我们有个关键的代码，就是：</p> <p>// 重点：记下弹窗前光标位置range</p> <div class="language- extra-class"><pre class="language-text"><code>this.editorRange = rangeInfo
</code></pre></div><p>由于我们之前的光标已经记下来了，因此，当选人确认后，我们要做的：就是把之前光标位置到前方@字符的内容delete删除，然后换成我们选择的人名(即我们创建的button标签)。代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">selectPerson</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    person<span class="token punctuation">.</span>corp_id <span class="token operator">=</span> person<span class="token punctuation">.</span>corp_id <span class="token operator">||</span> window<span class="token punctuation">.</span>corp_id<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'jsEditorElement'</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>editor<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        editor<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 删掉草稿start</span>

        <span class="token keyword">const</span> editorRange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editorRange<span class="token punctuation">.</span>range

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>editorRange<span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token keyword">const</span> textNode <span class="token operator">=</span> editorRange<span class="token punctuation">.</span>endContainer <span class="token comment">// 拿到末尾文本节点</span>

        <span class="token keyword">const</span> endOffset <span class="token operator">=</span> editorRange<span class="token punctuation">.</span>endOffset <span class="token comment">// 光标位置</span>

        <span class="token comment">// 找出光标前的at符号位置</span>

        <span class="token keyword">const</span> textNodeValue <span class="token operator">=</span> textNode<span class="token punctuation">.</span>nodeValue

        <span class="token keyword">const</span> expRes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@([^@]*)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>textNodeValue<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>expRes <span class="token operator">&amp;&amp;</span> expRes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            editorRange<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> expRes<span class="token punctuation">.</span>index<span class="token punctuation">)</span>

            editorRange<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> endOffset<span class="token punctuation">)</span>

            <span class="token comment">// console.log('要插入at的位置range', editorRange, editorRange.startOffset, editorRange.endOffset)</span>

            editorRange<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 删除草稿end</span>

            <span class="token comment">// console.log('delete后的range', editorRange, editorRange.startOffset, editorRange.endOffset)</span>

            <span class="token comment">// return</span>

            <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>

            btn<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>

            btn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

            btn<span class="token punctuation">.</span>contentEditable <span class="token operator">=</span> <span class="token boolean">false</span>

            btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">return</span> <span class="token boolean">false</span>

            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

            btn<span class="token punctuation">.</span>tabindex <span class="token operator">=</span> <span class="token string">'-1'</span>

            <span class="token keyword">const</span> bSpaceNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">'\u200b'</span><span class="token punctuation">)</span> <span class="token comment">// 不可见字符，为了放光标方便</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertHtmlAtCaret</span><span class="token punctuation">(</span><span class="token punctuation">[</span>btn<span class="token punctuation">,</span> bSpaceNode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editorRange<span class="token punctuation">.</span>selection<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editorRange<span class="token punctuation">.</span>range<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>人名隔离问题</p> <p>默认情况下，当我们的button添加到输入框之后，如果我们在 button 后方继续输入普通文本，那么文本可能会跑到button标签内部。</p> <p>例如，当你选择了小明之后，输入框中如果是这样的结构：</p> <p>你好，小明
当你在后方再输入：“一起吃饭”。那么，结构可能会变成：</p> <p>你好，小明一起吃饭把
新字符跑到了button标签内部，显然不符合我们的预期。因此，这里我们必须通过hack手段来解决。如何确保输入人名之后，再输入其他字符时自动产生一个新的textNode类型的节点，而不是插入到人名标签中呢？</p> <p>大家可能注意到上一小节代码中，我们给 insertHtmlAtCaret 函数传递元素时，除了传递button，还传递了一个自己创建的 textNode节点：const bSpaceNode = document.createTextNode('\u200b') // 不可见字符，为了放光标方便</p> <p>这个字符是一个不可见的字符，但他的确是一个字符。有了这么一个字符在 button 的后方，则我们新添加字符的话，他就是在 \u200b位置往后添加，这样就可以实现我们期望的效果了。 关于插入什么字符，业界通常也会使用空格字符来实现，例如QQ空间便是使用空格字符。</p> <p>而我这里为了不让领宽字符提交到后台，所以在提交之前做了下检测：// 从dom中拿出带有at信息的结构 (对于at是用button包裹，就把button里的date-person属性拿出来)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">getMsgStructure</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    elem <span class="token operator">=</span> elem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>

    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'#text'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">var</span> str <span class="token operator">=</span> child<span class="token punctuation">.</span>nodeValue

            <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">var</span> lastChar <span class="token operator">=</span> str<span class="token punctuation">[</span>str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>lastChar<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0x200b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token comment">// 零宽字符去掉</span>

                    str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> str<span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'BR'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'\n'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'BUTTON'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'at'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'SPAN'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> child<span class="token punctuation">.</span>textContent<span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    res <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">_defragmentation</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token keyword">return</span> res

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>数据碎片问题</p> <p>什么是数据碎片问题呢。举个栗子：</p> <p>例如：用户输入了 &quot;你好，@小明，吃了吗&quot; 这样一段话，当用户把“@小明” 删掉后，文本变成 “你好，吃了吗”，但实际上底层 contenteditable 文本域里面是2个 textNode：“你好，” 和 “吃了吗”。 虽然对于整体功能来说没什么大碍，但是不利于后端减少数据结构的冗余。</p> <p>那么这里的解决办法也比较容易，就是提交给后台之前，对同类型的 textNode 节点进行合并，减少碎片。这里简单实现了一下这个合并算法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">_defragmentation</span><span class="token punctuation">(</span><span class="token parameter">msgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// msgs 就是上文说说的消息数据结构</span>

    <span class="token keyword">const</span> newMsgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    msgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token keyword">const</span> last <span class="token operator">=</span> newMsgs<span class="token punctuation">[</span>newMsgs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">&amp;&amp;</span> last<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> last<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'text'</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            last<span class="token punctuation">.</span>data <span class="token operator">=</span> last<span class="token punctuation">.</span>data <span class="token operator">+</span> msg<span class="token punctuation">.</span>data

        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'text'</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span>renderLength <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

            newMsgs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> newMsgs

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>中文输入bug</p> <p>中文输入时，编辑器内会先出现拼音，此时会触发输入框的 keydown，keyup等事件，从而导致我们选人浮层开始出现。可是当用户按下 回车键，我们的选人逻辑会将选中的人名放置到输入框，而中文输入法会将他的候选词放入输入框，这里会导致“选的人”和“选的词”同时出现到输入框里。</p> <p>应该如何处理这种场景呢？我采用的办法是，检测到中文输入选词完毕后，我们及时更新我vue组件内的光标选取变量，从而让选人事件发生后，可以正确的删除前方的文案。</p> <p>例如：当用户输入 &quot;@x&quot;，此时他输入法中出现了 “小，晓，笑” 等候选词，同时此时我们的选人浮层也出现了。</p> <p>当他按下回车，此时输入法会立刻将“小”放置到输入框，从而输入框内容变成 &quot;@小&quot;。而此时，我需要立刻将我 Vue组件的 editorRange 变量更新，记录下此时光标位于 “@小” 后方。</p> <p>那么，接下来 回车会触发我的选人确认逻辑，此时我的逻辑会将光标位置开始到前方的@位置所有字符进行删除替换，因此 &quot;@小&quot;就变成了 “@小明”。</p> <p>做法：给输入框增加2个事件</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;@compositionstart=&quot;onCompositionStart&quot;

@compositiοnend=&quot;onCompositionEnd&quot;
</code></pre></div><p>方法实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onCompositionStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正在输入中文'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onCompositionEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShowDialog<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 重置光标位置，因为此时中文会填进去。。</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>editorRange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEditorRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>placeholder 的实现</p> <p>这里，我采用了 css 的简便方案，即通过 empty 伪类选择器，检测到 div 中内容为空时，我们往输入框的 after 伪类下添加一个 文本；当光标focus到输入框的时候，我们使用 focus 伪类再清掉 after元素的内容。从而实现 placeholder 的效果。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.at-editor-placeholder-cn:empty:before</span> <span class="token punctuation">{</span>

    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'填写内容，输入@以选择某人'</span><span class="token punctuation">;</span>

    <span class="token property">color</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token selector">.at-editor-placeholder-cn:focus:before</span> <span class="token punctuation">{</span>

    <span class="token property">content</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>粘贴的处理</p> <p>当用户进行“粘贴”，我们要拦截粘贴动作，并取其粘贴板上的文本内容，手工放置到光标位置。这里我在 onDoPaste 函数中实现:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">doOnPaste</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> pastedText <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>clipboardData <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>clipboardData<span class="token punctuation">.</span>getData<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// IE</span>

        pastedText <span class="token operator">=</span> window<span class="token punctuation">.</span>clipboardData<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'Text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clipboardData <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>clipboardData<span class="token punctuation">.</span>getData<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        pastedText <span class="token operator">=</span> e<span class="token punctuation">.</span>clipboardData<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 放到光标位置</span>

    <span class="token keyword">const</span> rangeInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEditorRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>rangeInfo <span class="token operator">&amp;&amp;</span> pastedText<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        rangeInfo<span class="token punctuation">.</span>range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> newTextNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>pastedText<span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertHtmlAtCaret</span><span class="token punctuation">(</span>newTextNode<span class="token punctuation">,</span> rangeInfo<span class="token punctuation">.</span>selection<span class="token punctuation">,</span> rangeInfo<span class="token punctuation">.</span>range<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>这里最主要是这一句：e.clipboardData.getData('text/plain');</p> <p>帮助我们拿到所有dom中的纯文本部分。</p> <p>总结</p> <p>至此，我们实现了一个 “看起来简单” 但 “要考虑的点特别多” 的输入框 at 功能。</p> <h2 id="「多图预警」完美实现一个-功能"><a href="#「多图预警」完美实现一个-功能" class="header-anchor">#</a> 「多图预警」完美实现一个@功能</h2> <p>地址：<a href="https://segmentfault.com/a/1190000042481321?utm_source=sf-hot-article" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000042481321?utm_source=sf-hot-article<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 富文本聊天消息输入框 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
     <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-input<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatInput<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">contenteditable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入内容<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inputChatContent<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">@blur</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatContentBlur<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">@mouseup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatContentMouseup<span class="token punctuation">&quot;</span></span>
     <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 用户列表浮窗 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popper<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShowUserList<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popper<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popperStyle<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">v-click-out-hide</span>
    <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in userList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectUser(item)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">getRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> selection <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> range
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/**
        * 输入聊天内容
        * @param {*} ev
        */</span>
        <span class="token function">inputChatContent</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 在输入@字符时候就保存一下光标</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveCaret</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">const</span> pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCaretPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUserListPos</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 获取光标位置
        * @returns
        */</span>
        <span class="token function">getCaretPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> pos <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> pos
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 设置用户列表的位置
        * @param {*} pos
        */</span>
        <span class="token function">setUserListPos</span><span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> $popper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>popper
            <span class="token keyword">const</span> panelWidth <span class="token operator">=</span> $popper<span class="token punctuation">.</span>offsetWidth
            <span class="token keyword">const</span> panelHeight <span class="token operator">=</span> $popper<span class="token punctuation">.</span>offsetHeight
            <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> pos

            <span class="token keyword">this</span><span class="token punctuation">.</span>popperStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">top</span><span class="token operator">:</span> y <span class="token operator">-</span> panelHeight <span class="token operator">-</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">left</span><span class="token operator">:</span> x <span class="token operator">-</span> panelWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">'px'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token function">hideUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isShowUserList <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token function">showUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isShowUserList <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>


        <span class="token comment">/**
        * 选择用户
        */</span>
        <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 让失焦事件先执行</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertContent</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 恢复光标
        */</span>
        <span class="token function">restoreCaret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastRange<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 插入内容
        * @param {*} data
        */</span>
        <span class="token function">insertContent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">restoreCaret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 还原光标</span>

            <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 折叠选区，光标移到最后</span>
            range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
            range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

            selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/**
        * 删除输入框中光标位置现有的@字符
        */</span>
        <span class="token function">deleteCaretAtCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 光标开始节点和光标在节点上的偏移量，找到光标准确位置，选中光标位置前一个字符范围并删除，</span>
            <span class="token keyword">const</span> node <span class="token operator">=</span> range<span class="token punctuation">.</span>startContainer
            <span class="token keyword">const</span> end <span class="token operator">=</span> range<span class="token punctuation">.</span>endOffset

            <span class="token comment">// 开始节点内容最后一个字符是@，删除，否则不删除</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>textContent<span class="token punctuation">[</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> end <span class="token operator">?</span> end <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
                range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 转换要插入光标位置的内容
        * @param {*} data
        */</span>
        <span class="token function">parseContent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> data
            <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token keyword">null</span>

            <span class="token comment">// type 是插入内容类型，可能是文本、@标签、图片、表情等</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'at'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 删除输入框中光标位置现有的@字符</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteCaretAtCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token keyword">const</span> $span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
                $span<span class="token punctuation">.</span>contentEditable <span class="token operator">=</span> <span class="token boolean">false</span>
                $span<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'tag'</span><span class="token punctuation">)</span>
                $span<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

                <span class="token comment">// 插入一个空格字符（\u0010）到@标签后面，可以解决部分浏览器上光标在聊天输入框后面</span>
                <span class="token keyword">const</span> $space <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">'\u0010'</span><span class="token punctuation">)</span>
                <span class="token keyword">const</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$span<span class="token punctuation">)</span>
                frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$space<span class="token punctuation">)</span>

                content <span class="token operator">=</span> frag
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> content
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">/**
        * 插入内容
        * @param {*} data
        */</span>
        <span class="token function">insertContent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">restoreCaret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 还原光标</span>

            <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 折叠选区，光标移到最后</span>

            <span class="token keyword">const</span> pc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseContent</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span>
            range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

            selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.popper li</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 用户不能选中文本 firfox 非编辑编辑元素也可选中 */</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/vue+svg.html" class="prev">
        vue引入svg图标
      </a></span> <span class="next"><a href="/vue/" class="router-link-active">
        vue问题总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8914b41c.js" defer></script><script src="/assets/js/3.7f8ab6bd.js" defer></script><script src="/assets/js/12.127689ae.js" defer></script>
  </body>
</html>
